import{r as u,J as G,e as J,o as k,c as S,a,u as D,d as p,w as n,F as P,y as c,a4 as A,B as K,I as Z,h as Q,M as W,Z as X,b as d,t as M,f as B,E as Y,H as ee,aH as ae,k as te,q as ne}from"./app-553d6252.js";import{r as oe,u as le}from"./xlsx-4f9172c7.js";import{S as se}from"./SearchOutlined-4e1d91f4.js";import"./AntdIcon-80ee18ce.js";const re={class:"p-4",style:{width:"100%",background:"white","border-radius":"8px"}},ie={class:"flex justify-between mb-2"},de={class:"flex gap-2"},ue={class:"flex gap-2"},fe={__name:"participantes",props:["proceso"],setup(F){const N=F,j=u([]),U=u([]),x=u(""),b=u(!1),m=u(!1),C=u("Nuevo Participante"),o=G({id:null,dni:"",paterno:"",materno:"",nombres:"",unidad:"",cod_examen:""}),O=[{title:"N°",dataIndex:"nro",width:50},{title:"DNI",dataIndex:"dni"},{title:"Ap. Paterno",dataIndex:"paterno"},{title:"Ap. Materno",dataIndex:"materno"},{title:"Nombres",dataIndex:"nombres"},{title:"Unidad",dataIndex:"unidad"},{title:"Cod Examen",dataIndex:"cod_examen"}],R=[{title:"N°",dataIndex:"nro",width:50},{title:"DNI",dataIndex:"dni"},{title:"Ap. Paterno",dataIndex:"paterno"},{title:"Ap. Materno",dataIndex:"materno"},{title:"Nombres",dataIndex:"nombres"},{title:"Unidad",dataIndex:"unidad"},{title:"Cod Examen",dataIndex:"cod_examen"},{title:"Acciones",dataIndex:"acciones",width:150}],v=async()=>{const s=await c.post("/get-participantes-externo",{term:x.value,proceso:N.proceso});j.value=s.data.datos.data};J(x,()=>{clearTimeout(window.t),window.t=setTimeout(v,300)}),v();const T=()=>{C.value="Nuevo Participante",Object.assign(o,{id:null,dni:"",paterno:"",materno:"",nombres:"",unidad:"",cod_examen:""}),m.value=!0},L=s=>{C.value="Editar Participante",Object.assign(o,s),m.value=!0},V=async()=>{o.id_proceso=N.proceso,o.id?await c.put(`/participantes/${o.id}`,o):await c.post("/participantes",o),A.success("Guardado"),m.value=!1,v()},$=async s=>{await c.delete(`/api/participantes/${s.id}`),A.success("Eliminado"),v()},h=s=>{const e=s.target.files[0],l=new FileReader;l.onload=r=>{const f=oe(new Uint8Array(r.target.result),{type:"array"}),y=f.Sheets[f.SheetNames[0]],w=le.sheet_to_json(y,{header:1}),E=w[0];U.value=w.slice(1).map(i=>{let g={};return E.forEach((t,_)=>{const I=t.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/ /g,"_");g[I]=i[_]}),g}),b.value=!0},l.readAsArrayBuffer(e)},z=async()=>{await c.post("/subir-participantes-simulacro",{data:U.value,proceso:N.proceso}),A.success("Subido"),b.value=!1,v()},H=async()=>{const s=await c.get("/descargar-template-participantes-simulacro",{responseType:"blob"}),e=URL.createObjectURL(new Blob([s.data])),l=document.createElement("a");l.href=e,l.download="template.xlsx",l.click(),URL.revokeObjectURL(e)};return(s,e)=>{const l=K,r=Z,f=Q,y=W,w=ee,E=ae,i=te,g=ne;return k(),S(P,null,[a(D(X),{title:"Participantes"}),p("div",re,[p("div",ie,[p("div",de,[e[9]||(e[9]=p("label",{for:"fileInput",class:"inline-block bg-[var(--primary-color)] text-white px-4 py-1 rounded-md cursor-pointer",style:{height:"32px"}}," Seleccionar archivo ",-1)),p("input",{id:"fileInput",type:"file",onChange:h,style:{display:"none"}},null,32)]),p("div",ue,[a(l,{type:"primary",onClick:T},{default:n(()=>e[10]||(e[10]=[d("Nuevo")])),_:1}),a(l,{onClick:H,style:{background:"green",color:"white"}},{default:n(()=>e[11]||(e[11]=[d(" Descargar ejemplo ")])),_:1}),a(r,{value:x.value,"onUpdate:value":e[0]||(e[0]=t=>x.value=t),placeholder:"Buscar",style:{"max-width":"230px"}},{prefix:n(()=>[a(D(se))]),_:1},8,["value"])])]),a(y,{open:b.value,"onUpdate:open":e[1]||(e[1]=t=>b.value=t),title:"Participantes del proceso",width:"94%"},{footer:n(()=>[a(l,{type:"primary",onClick:z},{default:n(()=>e[12]||(e[12]=[d(" Subir ")])),_:1})]),default:n(()=>[a(f,{dataSource:U.value,columns:O,rowKey:"dni",size:"small",pagination:!1},{bodyCell:n(({column:t,index:_})=>[t.dataIndex==="nro"?(k(),S(P,{key:0},[d(M(_+1),1)],64)):B("",!0)]),_:1},8,["dataSource"])]),_:1},8,["open"]),a(f,{dataSource:j.value,columns:R,size:"small",pagination:!1,scroll:{y:"calc(100vh - 310px)"}},{bodyCell:n(({column:t,index:_,record:I})=>[t.dataIndex==="nro"?(k(),S(P,{key:0},[d(M(_+1),1)],64)):B("",!0),t.dataIndex==="acciones"?(k(),Y(E,{key:1},{default:n(()=>[a(l,{type:"text",onClick:q=>L(I)},{default:n(()=>e[13]||(e[13]=[d("Edit")])),_:2},1032,["onClick"]),a(w,{title:"¿Eliminar?",onConfirm:q=>$(I)},{default:n(()=>[a(l,{type:"text",danger:""},{default:n(()=>e[14]||(e[14]=[d("Delete")])),_:1})]),_:2},1032,["onConfirm"])]),_:2},1024)):B("",!0)]),_:1},8,["dataSource"]),a(y,{open:m.value,"onUpdate:open":e[8]||(e[8]=t=>m.value=t),title:C.value,onOk:V},{default:n(()=>[a(g,{layout:"vertical"},{default:n(()=>[a(i,{label:"DNI"},{default:n(()=>[a(r,{value:o.dni,"onUpdate:value":e[2]||(e[2]=t=>o.dni=t)},null,8,["value"])]),_:1}),a(i,{label:"Ap. Paterno"},{default:n(()=>[a(r,{value:o.paterno,"onUpdate:value":e[3]||(e[3]=t=>o.paterno=t)},null,8,["value"])]),_:1}),a(i,{label:"Ap. Materno"},{default:n(()=>[a(r,{value:o.materno,"onUpdate:value":e[4]||(e[4]=t=>o.materno=t)},null,8,["value"])]),_:1}),a(i,{label:"Nombres"},{default:n(()=>[a(r,{value:o.nombres,"onUpdate:value":e[5]||(e[5]=t=>o.nombres=t)},null,8,["value"])]),_:1}),a(i,{label:"Unidad"},{default:n(()=>[a(r,{value:o.unidad,"onUpdate:value":e[6]||(e[6]=t=>o.unidad=t)},null,8,["value"])]),_:1}),a(i,{label:"Cod Examen"},{default:n(()=>[a(r,{value:o.cod_examen,"onUpdate:value":e[7]||(e[7]=t=>o.cod_examen=t)},null,8,["value"])]),_:1})]),_:1})]),_:1},8,["open","title"])])],64)}}};export{fe as default};

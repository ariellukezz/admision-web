import{r as i,J as P,e as Y,a1 as h,o as d,c as u,d as e,t as l,$ as c,b9 as _,aU as q,b0 as U,b as g,F as G,s as H,f as y,v as Q,aY as R}from"./app-6bc649a8.js";import{_ as W}from"./_plugin-vue_export-helper-c27b6911.js";const X={class:"container"},Z={class:"header"},ee={class:"filters"},oe={key:0},te={key:1},ae={key:2},ne=["onClick"],le=["onClick"],se=["onClick"],re={key:3,class:"pagination"},ie=["disabled"],de=["disabled"],ue={key:4,class:"modal-overlay"},pe={class:"modal"},ce={class:"modal-header"},ve={class:"form-group"},ge={class:"form-group"},_e={class:"form-group"},me={class:"form-group"},be={class:"form-group"},fe={class:"form-group"},xe={class:"form-group"},ye={class:"modal-footer"},Ce={type:"submit"},Ee={key:5,class:"modal-overlay"},ke={class:"modal"},Ve={key:0,class:"details"},je={key:0},Ne={key:1},Pe={__name:"excepciones",props:{id_proceso:{type:[Number,String],required:!0}},setup(M){const b=M,E=i([]),k=i(!1),C=i(!1),V=i(!1),f=i("create"),s=i(null),v=P({cod_examen:"",nro_pregunta:"",tipo:""}),n=P({nro_pregunta:"",accion:"",cod_examen:"",observacion:"",claves_validas:"",puntaje:"",tipo:"",id_proceso:b.id_proceso}),r=P({current_page:1,last_page:1,total:0}),p=async()=>{k.value=!0;try{const a={page:r.current_page,id_proceso:b.id_proceso,...Object.fromEntries(Object.entries(v).filter(([t,m])=>m!==""))},o=await axios.get("/api/excepciones",{params:a});E.value=o.data.data.data,Object.assign(r,{current_page:o.data.data.current_page,last_page:o.data.data.last_page,total:o.data.data.total})}catch(a){console.error("Error:",a),alert("Error al cargar datos")}finally{k.value=!1}},D=()=>{v.cod_examen="",v.nro_pregunta="",v.tipo="",p()},S=()=>{f.value="create",Object.keys(n).forEach(a=>{a!=="id_proceso"&&(n[a]="")}),n.id_proceso=b.id_proceso,C.value=!0},I=a=>{s.value=a,V.value=!0},O=a=>{f.value="edit",Object.keys(n).forEach(o=>{n[o]=a[o]||""}),n.id=a.id,C.value=!0},T=async()=>{var a,o,t,m;try{const x=f.value==="create"?"/api/excepciones":`/api/excepciones/${n.id}`,j=f.value==="create"?"post":"put",N={...n};N.id_proceso||(N.id_proceso=b.id_proceso),await axios[j](x,N),C.value=!1,p(),alert("Excepción guardada correctamente")}catch(x){if(console.error("Error:",x),(o=(a=x.response)==null?void 0:a.data)!=null&&o.errors){const j=Object.values(x.response.data.errors).flat().join(`
`);alert(`Errores:
`+j)}else alert(((m=(t=x.response)==null?void 0:t.data)==null?void 0:m.message)||"Error al guardar")}},$=async a=>{if(confirm("¿Eliminar esta excepción?"))try{await axios.delete(`/api/excepciones/${a.id}`),p(),alert("Excepción eliminada")}catch(o){console.error("Error:",o),alert("Error al eliminar")}},w=()=>{C.value=!1},A=()=>{V.value=!1},B=()=>{r.current_page>1&&(r.current_page--,p())},F=()=>{r.current_page<r.last_page&&(r.current_page++,p())};Y(()=>b.id_proceso,a=>{a&&(n.id_proceso=a,p())});const K=i([]),L=i([]),z=i([]);i(null),i(null),i(null);const J=async()=>{axios.get("/calificacion/get-select-puestos/"+b.id_proceso).then(a=>{K.value=a.data.puestos,L.value=a.data.codigos_puesto,z.value=a.data.codigos_examen}).catch(a=>{a.response?console.error("Error de servidor:",a.response.data):a.request?console.error("Error de red:",a.request):console.error("Error de configuración:",a.message)})};return h(()=>{p(),J()}),(a,o)=>(d(),u("div",X,[e("div",Z,[e("h2",null,"Excepciones - Proceso #"+l(M.id_proceso),1),e("button",{onClick:S,class:"btn btn-primary"},"Nueva Excepción")]),e("div",ee,[c(e("input",{"onUpdate:modelValue":o[0]||(o[0]=t=>v.cod_examen=t),placeholder:"Código Examen",onKeyup:q(p,["enter"])},null,544),[[_,v.cod_examen]]),c(e("input",{"onUpdate:modelValue":o[1]||(o[1]=t=>v.nro_pregunta=t),placeholder:"N° Pregunta",type:"number",onKeyup:q(p,["enter"])},null,544),[[_,v.nro_pregunta]]),c(e("select",{"onUpdate:modelValue":o[2]||(o[2]=t=>v.tipo=t),onChange:p},o[11]||(o[11]=[e("option",{value:""},"Todos los tipos",-1),e("option",{value:"correccion"},"Corrección",-1),e("option",{value:"anulacion"},"Anulación",-1),e("option",{value:"validacion"},"Validación",-1)]),544),[[U,v.tipo]]),e("button",{onClick:p},"Buscar"),e("button",{onClick:D},"Limpiar")]),k.value?(d(),u("div",oe,"Cargando...")):E.value.length===0?(d(),u("div",te,[e("p",null,[o[12]||(o[12]=g("No hay excepciones para este proceso. ")),e("a",{href:"#",onClick:S},"Crear la primera")])])):(d(),u("table",ae,[o[13]||(o[13]=e("thead",null,[e("tr",null,[e("th",null,"ID"),e("th",null,"N° Preg"),e("th",null,"Código"),e("th",null,"Acción"),e("th",null,"Puntaje"),e("th",null,"Tipo"),e("th",null,"Acciones")])],-1)),e("tbody",null,[(d(!0),u(G,null,H(E.value,t=>(d(),u("tr",{key:t.id},[e("td",null,l(t.id),1),e("td",null,l(t.nro_pregunta),1),e("td",null,l(t.cod_examen),1),e("td",null,l(t.accion),1),e("td",null,l(t.puntaje),1),e("td",null,l(t.tipo),1),e("td",null,[e("button",{onClick:m=>I(t)},"Ver",8,ne),e("button",{onClick:m=>O(t)},"Editar",8,le),e("button",{onClick:m=>$(t)},"Eliminar",8,se)])]))),128))])])),r.last_page>1?(d(),u("div",re,[e("button",{onClick:B,disabled:r.current_page===1},"Anterior",8,ie),e("span",null,"Página "+l(r.current_page)+" de "+l(r.last_page),1),e("button",{onClick:F,disabled:r.current_page===r.last_page},"Siguiente",8,de)])):y("",!0),C.value?(d(),u("div",ue,[e("div",pe,[e("div",ce,[e("h3",null,l(f.value==="create"?"Nueva":"Editar")+" Excepción",1),e("button",{onClick:w},"×")]),e("form",{onSubmit:Q(T,["prevent"])},[c(e("input",{type:"hidden","onUpdate:modelValue":o[3]||(o[3]=t=>n.id_proceso=t)},null,512),[[_,n.id_proceso]]),e("div",ve,[o[14]||(o[14]=e("label",null,"N° Pregunta *",-1)),c(e("input",{"onUpdate:modelValue":o[4]||(o[4]=t=>n.nro_pregunta=t),type:"number",required:""},null,512),[[_,n.nro_pregunta]])]),e("div",ge,[o[15]||(o[15]=e("label",null,"Código Examen *",-1)),c(e("input",{"onUpdate:modelValue":o[5]||(o[5]=t=>n.cod_examen=t),required:""},null,512),[[_,n.cod_examen]])]),e("div",_e,[o[17]||(o[17]=e("label",null,"Acción *",-1)),c(e("select",{"onUpdate:modelValue":o[6]||(o[6]=t=>n.accion=t),required:""},o[16]||(o[16]=[e("option",{value:""},"Seleccionar",-1),e("option",{value:"todas_validas"},"Todas validas",-1)]),512),[[U,n.accion]])]),e("div",me,[o[18]||(o[18]=e("label",null,"Puntaje *",-1)),c(e("input",{"onUpdate:modelValue":o[7]||(o[7]=t=>n.puntaje=t),type:"number",step:"0.01",required:""},null,512),[[_,n.puntaje]])]),e("div",be,[o[20]||(o[20]=e("label",null,"Tipo *",-1)),c(e("select",{"onUpdate:modelValue":o[8]||(o[8]=t=>n.tipo=t),required:""},o[19]||(o[19]=[R('<option value="" data-v-0a3b4857>Seleccionar</option><option value="correccion" data-v-0a3b4857>Corrección</option><option value="anulacion" data-v-0a3b4857>Anulación</option><option value="validacion" data-v-0a3b4857>Validación</option><option value="especial" data-v-0a3b4857>Especial</option>',5)]),512),[[U,n.tipo]])]),e("div",fe,[o[21]||(o[21]=e("label",null,"Observación",-1)),c(e("textarea",{"onUpdate:modelValue":o[9]||(o[9]=t=>n.observacion=t)},null,512),[[_,n.observacion]])]),e("div",xe,[o[22]||(o[22]=e("label",null,"Claves Válidas",-1)),c(e("input",{"onUpdate:modelValue":o[10]||(o[10]=t=>n.claves_validas=t),placeholder:"Ej: A,B,C (separadas por comas)"},null,512),[[_,n.claves_validas]])]),e("div",ye,[e("button",{type:"button",onClick:w},"Cancelar"),e("button",Ce,l(f.value==="create"?"Crear":"Actualizar"),1)])],32)])])):y("",!0),V.value?(d(),u("div",Ee,[e("div",ke,[e("div",{class:"modal-header"},[o[23]||(o[23]=e("h3",null,"Detalles Excepción",-1)),e("button",{onClick:A},"×")]),s.value?(d(),u("div",Ve,[e("p",null,[o[24]||(o[24]=e("strong",null,"ID:",-1)),g(" "+l(s.value.id),1)]),e("p",null,[o[25]||(o[25]=e("strong",null,"ID Proceso:",-1)),g(" "+l(s.value.id_proceso),1)]),e("p",null,[o[26]||(o[26]=e("strong",null,"N° Pregunta:",-1)),g(" "+l(s.value.nro_pregunta),1)]),e("p",null,[o[27]||(o[27]=e("strong",null,"Código Examen:",-1)),g(" "+l(s.value.cod_examen),1)]),e("p",null,[o[28]||(o[28]=e("strong",null,"Acción:",-1)),g(" "+l(s.value.accion),1)]),e("p",null,[o[29]||(o[29]=e("strong",null,"Puntaje:",-1)),g(" "+l(s.value.puntaje),1)]),e("p",null,[o[30]||(o[30]=e("strong",null,"Tipo:",-1)),g(" "+l(s.value.tipo),1)]),s.value.observacion?(d(),u("p",je,[o[31]||(o[31]=e("strong",null,"Observación:",-1)),g(" "+l(s.value.observacion),1)])):y("",!0),s.value.claves_validas?(d(),u("p",Ne,[o[32]||(o[32]=e("strong",null,"Claves Válidas:",-1)),g(" "+l(s.value.claves_validas),1)])):y("",!0)])):y("",!0),e("div",{class:"modal-footer"},[e("button",{onClick:A},"Cerrar")])])])):y("",!0)]))}},Se=W(Pe,[["__scopeId","data-v-0a3b4857"]]);export{Se as default};

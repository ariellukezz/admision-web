import{a as t,aI as ye,r as u,J as ee,C as xe,e as te,o as f,c as h,w as a,B as he,M as we,b as d,d as l,t as C,f as M,E as oe,u as E,y as R,a4 as b,I as ke,_ as Ce,K as De,H as Oe,aJ as Ue,h as Se,k as Ee,l as Fe,S as Le,j as je,m as ze,a7 as Ie,q as $e}from"./app-78d8570a.js";import{_ as Be}from"./_plugin-vue_export-helper-c27b6911.js";import{A as Me}from"./AntdIcon-6b50a2df.js";import{E as Re}from"./EyeOutlined-c4f4f235.js";import{D as Te}from"./DownloadOutlined-ceffa4e3.js";import{D as ae}from"./DeleteOutlined-4a234af8.js";import{U as Pe}from"./UploadOutlined-3e82fd60.js";function ne(y){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?Object(arguments[r]):{},c=Object.keys(i);typeof Object.getOwnPropertySymbols=="function"&&(c=c.concat(Object.getOwnPropertySymbols(i).filter(function(w){return Object.getOwnPropertyDescriptor(i,w).enumerable}))),c.forEach(function(w){Ne(y,w,i[w])})}return y}function Ne(y,r,i){return r in y?Object.defineProperty(y,r,{value:i,enumerable:!0,configurable:!0,writable:!0}):y[r]=i,y}var q=function(r,i){var c=ne({},r,i.attrs);return t(Me,ne({},c,{icon:ye}),null)};q.displayName="FileTextOutlined";q.inheritAttrs=!1;const Ae=q;const Ve={class:"crud-container"},Ge={class:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-6 p-4 bg-gray-50 rounded-lg"},We={class:"flex flex-col sm:flex-row items-start sm:items-center gap-4 w-full"},qe={class:"flex gap-2"},Je={key:0,class:"flex items-center gap-2"},He=["onClick"],Qe={key:2,class:"text-gray-600 font-medium"},Ke={class:"border-2 border-dashed border-gray-300 rounded-lg p-6 text-center hover:border-blue-400 transition-colors"},Xe={key:1,class:"text-left"},Ye={class:"flex items-center justify-between mb-4"},Ze={class:"flex items-center gap-3"},et={class:"font-medium text-gray-800"},tt={class:"text-sm text-gray-500"},ot={class:"mt-4"},at={class:"border rounded-lg p-4 bg-gray-50 max-h-80 overflow-y-auto"},nt=["src"],lt={key:1,class:"text-center text-gray-500 py-8"},st={class:"flex justify-end gap-3 mt-6 pt-4 border-t"},rt={class:"pdf-viewer-container"},it={class:"flex justify-between items-center mb-4 p-4 bg-gray-50 rounded-lg"},ut={class:"font-semibold text-lg text-gray-800"},dt={class:"pdf-frame-container"},ct=["src"],pt={key:1,class:"flex justify-center items-center h-96"},mt={class:"text-center"},ft={__name:"documentos_observacion",setup(y){const r=u(!1),i=u(!1),c=u(!1),w=u(!1),T=u(!1),F=u(""),I=u([]),v=u(null),x=u(""),P=u(null),p=u(""),D=u(null),O=u(""),N=u(),_=ee({nombre:"",tipo:"general",archivo:null}),le={nombre:[{required:!0,message:"El nombre es obligatorio"},{min:3,message:"Mínimo 3 caracteres"}],tipo:[{required:!0,message:"El tipo es obligatorio"}]},se=[{title:"ID",dataIndex:"id",key:"id",width:70,align:"center"},{title:"NOMBRE",dataIndex:"nombre",key:"nombre",width:240,ellipsis:!0},{title:"TIPO",dataIndex:"tipo",key:"tipo",width:140,align:"center"},{title:"FECHA SUBIDA",dataIndex:"fecha_subida",key:"fecha_subida",width:140,align:"center"},{title:"ACCIONES",key:"actions",width:120,align:"center",fixed:"right"}],J=ee({current:1,pageSize:10,total:0,showSizeChanger:!0,showQuickJumper:!0,showTotal:(o,e)=>`${e[0]}-${e[1]} de ${o} documentos`}),re=xe(()=>F.value?I.value.filter(o=>o.nombre.toLowerCase().includes(F.value.toLowerCase())||o.tipo.toLowerCase().includes(F.value.toLowerCase())):I.value),A=async()=>{w.value=!0;try{const o=await R.get("https://servicios-admision.unap.edu.pe/api/v1/observados/documentos");I.value=o.data.data||o.data,J.total=I.value.length}catch(o){b.error("Error al cargar los documentos"),console.error(o)}finally{w.value=!1}},H=async o=>{D.value=o,c.value=!0;try{const e=await R.get(`https://servicios-admision.unap.edu.pe/api/v1/observados/documentos/${o.id}/descargar`,{responseType:"arraybuffer"}),n=new Blob([e.data],{type:"application/pdf"});O.value=URL.createObjectURL(n)}catch(e){console.error("❌ Error al cargar el documento:",e),b.error("Error al cargar el documento")}},Q=async o=>{try{const n=await(await fetch(`https://servicios-admision.unap.edu.pe/api/v1/observados/documentos/${o.id}/descargar`)).text(),g=unescape(encodeURIComponent(n)),$=new Uint8Array(g.length);for(let U=0;U<g.length;U++)$[U]=g.charCodeAt(U)&255;const L=new Blob([$],{type:"application/pdf"}),B=URL.createObjectURL(L),k=document.createElement("a");k.href=B,k.download=`${o.nombre}.pdf`,document.body.appendChild(k),k.click(),document.body.removeChild(k),setTimeout(()=>URL.revokeObjectURL(B),5e3),b.success("PDF descargado correctamente")}catch(e){console.error("Error:",e),b.error("Error al descargar el PDF")}},ie=()=>{Object.assign(_,{nombre:"",tipo:"general",archivo:null}),v.value=null,x.value="",p.value="",i.value=!0},ue=o=>{const e=o.target.files[0];if(p.value="",!e)return;if(e.type!=="application/pdf"){p.value="Solo se permiten archivos PDF";return}if(!(e.size/1024/1024<10)){p.value="El archivo debe ser menor a 10MB";return}v.value=e,_.archivo=e,de(e)},de=o=>{x.value&&URL.revokeObjectURL(x.value),x.value=URL.createObjectURL(o)},K=()=>{v.value=null,_.archivo=null,p.value="",x.value&&(URL.revokeObjectURL(x.value),x.value=""),P.value&&(P.value.value="")},ce=o=>{if(o===0)return"0 Bytes";const e=1024,n=["Bytes","KB","MB","GB"],g=Math.floor(Math.log(o)/Math.log(e));return parseFloat((o/Math.pow(e,g)).toFixed(2))+" "+n[g]},X=async()=>{var o,e;try{if(await N.value.validate(),!v.value){p.value="Seleccione un archivo PDF";return}if(p.value)return;T.value=!0;const n=new FormData;n.append("nombre",_.nombre),n.append("tipo",_.tipo),n.append("archivo",v.value);const g=await R.post("https://servicios-admision.unap.edu.pe/api/v1/observados/documentos",n,{headers:{"Content-Type":"multipart/form-data"},timeout:3e4});b.success("Documento subido correctamente"),await A(),V()}catch(n){if(n.errorFields){v.value||(p.value="Seleccione un archivo PDF");return}(e=(o=n.response)==null?void 0:o.data)!=null&&e.error?b.error(`${n.response.data.error}`):n.code==="ECONNABORTED"?b.error("Tiempo de espera agotado. Intente nuevamente."):b.error("Error al subir el documento"),console.error("Error detallado:",n)}finally{T.value=!1}},pe=async o=>{try{await R.delete(`https://servicios-admision.unap.edu.pe/api/v1/observados/documentos/${o}`),b.success("Documento eliminado correctamente"),await A()}catch(e){b.error("Error al eliminar el documento"),console.error(e)}},me=o=>({general:"blue",contrato:"green",informe:"orange",formulario:"purple",oficio:"red"})[o]||"default",fe=o=>new Date(o).toLocaleDateString("es-ES",{day:"2-digit",month:"2-digit",year:"numeric"}),V=()=>{var o;i.value=!1,(o=N.value)==null||o.resetFields(),K(),p.value=""};return te(c,o=>{!o&&O.value&&(URL.revokeObjectURL(O.value),O.value="",D.value=null)}),te(r,o=>{o&&A()}),(o,e)=>{const n=he,g=ke,$=Ce,L=De,B=Oe,k=Ue,U=Se,G=Ee,Y=Fe,j=Le,ve=je,_e=ze,Z=Ie,ge=$e,W=we;return f(),h("div",null,[t(n,{type:"primary",onClick:e[0]||(e[0]=z=>r.value=!0),class:"mb-4"},{default:a(()=>e[10]||(e[10]=[d(" Gestionar Documentos ")])),_:1}),t(W,{open:r.value,"onUpdate:open":e[9]||(e[9]=z=>r.value=z),title:"Gestión de Documentos",width:"95%",footer:null,styles:{maxWidth:"1400px"}},{default:a(()=>{var z;return[l("div",Ve,[l("div",Ge,[l("div",We,[t(g,{value:F.value,"onUpdate:value":e[1]||(e[1]=s=>F.value=s),placeholder:"Buscar por nombre o tipo...",style:{width:"100%",maxWidth:"300px"},size:"large"},null,8,["value"]),l("div",qe,[t(n,{type:"primary",onClick:ie,class:"w-full sm:w-auto bg-blue-600 hover:bg-blue-700",size:"large"},{default:a(()=>e[11]||(e[11]=[d(" Subir Documento ")])),_:1})])])]),t(U,{columns:se,"data-source":re.value,loading:w.value,pagination:J,"row-key":"id",scroll:{x:600},class:"custom-table",size:"middle"},{bodyCell:a(({column:s,record:m})=>[s.key==="nombre"?(f(),h("div",Je,[l("span",{class:"font-medium text-gray-800 cursor-pointer hover:text-blue-600",onClick:S=>H(m)},C(m.nombre),9,He)])):M("",!0),s.key==="tipo"?(f(),oe($,{key:1,color:me(m.tipo),class:"font-semibold px-3 py-1 rounded-full"},{default:a(()=>[d(C(m.tipo.toUpperCase()),1)]),_:2},1032,["color"])):M("",!0),s.key==="fecha_subida"?(f(),h("div",Qe,C(fe(m.fecha_subida)),1)):M("",!0),s.key==="actions"?(f(),oe(k,{key:3,size:"middle"},{default:a(()=>[t(L,{title:"Ver documento"},{default:a(()=>[t(n,{type:"link",size:"small",onClick:S=>H(m),class:"text-blue-600 hover:text-blue-800 p-0"},{default:a(()=>[t(E(Re))]),_:2},1032,["onClick"])]),_:2},1024),t(L,{title:"Descargar"},{default:a(()=>[t(n,{type:"link",size:"small",onClick:S=>Q(m),class:"text-green-600 hover:text-green-800 p-0"},{default:a(()=>[t(E(Te))]),_:2},1032,["onClick"])]),_:2},1024),t(L,{title:"Eliminar"},{default:a(()=>[t(B,{title:"¿Estás seguro de eliminar este documento?","ok-text":"Sí","cancel-text":"No",onConfirm:S=>pe(m.id)},{default:a(()=>[t(n,{type:"link",danger:"",size:"small",class:"hover:text-red-700 p-0"},{default:a(()=>[t(E(ae))]),_:1})]),_:2},1032,["onConfirm"])]),_:2},1024)]),_:2},1024)):M("",!0)]),_:1},8,["data-source","loading","pagination"]),t(W,{open:i.value,"onUpdate:open":e[5]||(e[5]=s=>i.value=s),title:"Subir Nuevo Documento",onCancel:V,width:"90%",styles:{maxWidth:"800px"},maskClosable:!1,footer:null},{default:a(()=>[t(ge,{ref_key:"formRef",ref:N,model:_,rules:le,layout:"vertical",class:"space-y-4",onSubmit:X},{default:a(()=>[t(_e,{gutter:16},{default:a(()=>[t(Y,{xs:24,sm:12},{default:a(()=>[t(G,{label:"Nombre del documento",name:"nombre"},{default:a(()=>[t(g,{value:_.nombre,"onUpdate:value":e[2]||(e[2]=s=>_.nombre=s),placeholder:"Ingrese el nombre del documento",size:"large"},null,8,["value"])]),_:1})]),_:1}),t(Y,{xs:24,sm:12},{default:a(()=>[t(G,{label:"Tipo de documento",name:"tipo"},{default:a(()=>[t(ve,{value:_.tipo,"onUpdate:value":e[3]||(e[3]=s=>_.tipo=s),placeholder:"Seleccione el tipo de documento",size:"large"},{default:a(()=>[t(j,{value:"general"},{default:a(()=>e[12]||(e[12]=[d("General")])),_:1}),t(j,{value:"contrato"},{default:a(()=>e[13]||(e[13]=[d("Contrato")])),_:1}),t(j,{value:"informe"},{default:a(()=>e[14]||(e[14]=[d("Informe")])),_:1}),t(j,{value:"formulario"},{default:a(()=>e[15]||(e[15]=[d("Formulario")])),_:1}),t(j,{value:"oficio"},{default:a(()=>e[16]||(e[16]=[d("Oficio")])),_:1})]),_:1},8,["value"])]),_:1})]),_:1})]),_:1}),t(G,{label:"Seleccionar PDF",name:"archivo","validate-status":p.value?"error":"",help:p.value},{default:a(()=>[l("div",Ke,[l("input",{type:"file",ref_key:"fileInput",ref:P,onChange:ue,accept:".pdf",class:"hidden"},null,544),v.value?(f(),h("div",Xe,[l("div",Ye,[l("div",Ze,[t(E(Ae),{class:"text-blue-500 text-xl"}),l("div",null,[l("div",et,C(v.value.name),1),l("div",tt,C(ce(v.value.size)),1)])]),t(n,{type:"link",onClick:K,class:"text-red-500"},{default:a(()=>[t(E(ae)),e[18]||(e[18]=d(" Eliminar "))]),_:1})]),l("div",ot,[e[20]||(e[20]=l("div",{class:"text-sm font-medium text-gray-700 mb-2"},"Vista previa:",-1)),l("div",at,[x.value?(f(),h("iframe",{key:0,src:x.value,class:"w-full h-64 border-0",frameborder:"0"},null,8,nt)):(f(),h("div",lt,[t(Z,{size:"large"}),e[19]||(e[19]=l("div",{class:"mt-2"},"Cargando vista previa...",-1))]))])])])):(f(),h("div",{key:0,class:"cursor-pointer",onClick:e[4]||(e[4]=s=>o.$refs.fileInput.click())},e[17]||(e[17]=[l("div",{class:"text-lg font-medium text-gray-600"},"Click para seleccionar PDF",-1),l("div",{class:"text-sm text-gray-500 mt-1"},"Máximo 10MB",-1)])))])]),_:1},8,["validate-status","help"])]),_:1},8,["model"]),l("div",st,[t(n,{onClick:V,size:"large"},{default:a(()=>e[21]||(e[21]=[d(" Cancelar ")])),_:1}),t(n,{type:"primary",onClick:X,loading:T.value,disabled:!v.value,size:"large",class:"bg-blue-600 hover:bg-blue-700"},{default:a(()=>[t(E(Pe)),e[22]||(e[22]=d(" Subir Documento "))]),_:1},8,["loading","disabled"])])]),_:1},8,["open"]),t(W,{open:c.value,"onUpdate:open":e[8]||(e[8]=s=>c.value=s),title:`Documento: ${((z=D.value)==null?void 0:z.nombre)||""}`,width:"95%",styles:{maxWidth:"1200px",top:"20px"},footer:null,maskClosable:!0,class:"pdf-modal"},{default:a(()=>{var s,m,S;return[l("div",rt,[l("div",it,[l("div",ut,C((s=D.value)==null?void 0:s.nombre)+" - "+C((S=(m=D.value)==null?void 0:m.tipo)==null?void 0:S.toUpperCase()),1),t(k,null,{default:a(()=>[t(n,{onClick:e[6]||(e[6]=be=>Q(D.value)),icon:"download",type:"primary",class:"bg-green-600 hover:bg-green-700"},{default:a(()=>e[23]||(e[23]=[d(" Descargar ")])),_:1}),t(n,{onClick:e[7]||(e[7]=be=>c.value=!1)},{default:a(()=>e[24]||(e[24]=[d(" Cerrar ")])),_:1})]),_:1})]),l("div",dt,[O.value?(f(),h("iframe",{key:0,src:O.value,class:"pdf-iframe",frameborder:"0"},null,8,ct)):(f(),h("div",pt,[l("div",mt,[t(Z,{size:"large"}),e[25]||(e[25]=l("div",{class:"mt-4 text-gray-600"},"Cargando documento...",-1))])]))])])]}),_:1},8,["open","title"])])]}),_:1},8,["open"])])}}},vt=Be(ft,[["__scopeId","data-v-ee2ce2df"]]),kt=Object.freeze(Object.defineProperty({__proto__:null,default:vt},Symbol.toStringTag,{value:"Module"}));export{vt as D,Ae as F,kt as d};

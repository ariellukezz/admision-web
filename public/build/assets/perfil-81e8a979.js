/* empty css                                                               */import{_ as ba}from"./_plugin-vue_export-helper-c27b6911.js";import{a as e,r as w,C as M,H as B,e as Y,o as O,c as S,d as t,w as s,t as f,a5 as p,an as wa,_ as ya,B as Pa,m as Ca,M as xa,u as y,b,F as ha,s as Oa,E as ka,T as K,x as za,f as Ea,ao as Sa,ap as Aa,g as Da,P as Ma,l as Ua,aq as $a,ar as La,O as Ia,G as Na,k as Fa,U as ja,V as Va,q as Ba,I as qa}from"./app-d59ad026.js";import{U as k}from"./UserOutlined-fc2e5cab.js";import{A as ta}from"./AntdIcon-fb17ae9a.js";import{E as Ha}from"./EditOutlined-8ce5359b.js";var Ta={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M832 464h-68V240c0-70.7-57.3-128-128-128H388c-70.7 0-128 57.3-128 128v224h-68c-17.7 0-32 14.3-32 32v384c0 17.7 14.3 32 32 32h640c17.7 0 32-14.3 32-32V496c0-17.7-14.3-32-32-32zM332 240c0-30.9 25.1-56 56-56h248c30.9 0 56 25.1 56 56v224H332V240zm460 600H232V536h560v304zM484 701v53c0 4.4 3.6 8 8 8h40c4.4 0 8-3.6 8-8v-53a48.01 48.01 0 10-56 0z"}}]},name:"lock",theme:"outlined"};const Ra=Ta;var Ga={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M866.9 169.9L527.1 54.1C523 52.7 517.5 52 512 52s-11 .7-15.1 2.1L157.1 169.9c-8.3 2.8-15.1 12.4-15.1 21.2v482.4c0 8.8 5.7 20.4 12.6 25.9L499.3 968c3.5 2.7 8 4.1 12.6 4.1s9.2-1.4 12.6-4.1l344.7-268.6c6.9-5.4 12.6-17 12.6-25.9V191.1c.2-8.8-6.6-18.3-14.9-21.2zM810 654.3L512 886.5 214 654.3V226.7l298-101.6 298 101.6v427.6zm-405.8-201c-3-4.1-7.8-6.6-13-6.6H336c-6.5 0-10.3 7.4-6.5 12.7l126.4 174a16.1 16.1 0 0026 0l212.6-292.7c3.8-5.3 0-12.7-6.5-12.7h-55.2c-5.1 0-10 2.5-13 6.6L468.9 542.4l-64.7-89.1z"}}]},name:"safety-certificate",theme:"outlined"};const Za=Ga;function aa(u){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?Object(arguments[n]):{},m=Object.keys(i);typeof Object.getOwnPropertySymbols=="function"&&(m=m.concat(Object.getOwnPropertySymbols(i).filter(function(v){return Object.getOwnPropertyDescriptor(i,v).enumerable}))),m.forEach(function(v){Ja(u,v,i[v])})}return u}function Ja(u,n,i){return n in u?Object.defineProperty(u,n,{value:i,enumerable:!0,configurable:!0,writable:!0}):u[n]=i,u}var H=function(n,i){var m=aa({},n,i.attrs);return e(ta,aa({},m,{icon:Ra}),null)};H.displayName="LockOutlined";H.inheritAttrs=!1;const Qa=H;function ea(u){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?Object(arguments[n]):{},m=Object.keys(i);typeof Object.getOwnPropertySymbols=="function"&&(m=m.concat(Object.getOwnPropertySymbols(i).filter(function(v){return Object.getOwnPropertyDescriptor(i,v).enumerable}))),m.forEach(function(v){Wa(u,v,i[v])})}return u}function Wa(u,n,i){return n in u?Object.defineProperty(u,n,{value:i,enumerable:!0,configurable:!0,writable:!0}):u[n]=i,u}var T=function(n,i){var m=ea({},n,i.attrs);return e(ta,ea({},m,{icon:Za}),null)};T.displayName="SafetyCertificateOutlined";T.inheritAttrs=!1;const q=T,Xa={class:"profile-container"},Ya={class:"profile-header"},Ka={class:"header-info"},ae={class:"email"},ee={class:"tags"},te={class:"quick-actions"},se={class:"activity-item"},oe={class:"activity-title"},re={class:"activity-desc"},le={class:"activity-time"},ne={class:"signature-modal"},ie={class:"signature-header"},ce={class:"certificate-display"},de={class:"certificate-header"},ue={key:0,class:"certificate-content"},fe={class:"field"},pe={class:"value"},me={class:"field"},ve={class:"value"},_e={class:"field"},ge={class:"value"},be={class:"field"},we={class:"value"},ye={class:"field"},Pe={class:"value expiry"},Ce={key:1,class:"certificate-content empty-certificate"},xe={class:"signature-status"},he={key:0,class:"password-strength"},Oe={class:"strength-meter"},ke={class:"strength-text"},ze={__name:"perfil",setup(u){const n=w(!1),i=w(!1),m=w(!1),v=w(!1);w(!0),w(!1);const U=w(!1),$=w(!1),C=w(null),l=M({dni:"",name:"",paterno:"",materno:"",email:"",celular:"",id_proceso:null,id_rol:null,rol:"",proceso:"",estado:null,foto:"https://i.pinimg.com/originals/2b/93/d8/2b93d8b64d3350b1151ac2ef05e89702.jpg"}),g=B(()=>({name:l.name,paterno:l.paterno,materno:l.materno,email:l.email,celular:l.celular})),_=M({dni:l.dni,email:l.email,usuario:`${l.name} ${l.paterno} ${l.materno}`,rol:l.rol,estado:!0,departamento:"Dirección de admisión",password_p12:"",valid_days:365}),c=M({currentPassword:"",newPassword:"",confirmPassword:""}),d=M({percent:0,text:"",class:""}),R=w([]);w([]);const sa={currentPassword:[{required:!0,message:"Ingresa tu contraseña actual",trigger:"blur"}],newPassword:[{required:!0,message:"Ingresa una nueva contraseña",trigger:"blur"},{min:8,message:"Mínimo 8 caracteres",trigger:"blur"},{validator:(o,a)=>{const L=/[A-Z]/.test(a),z=/[a-z]/.test(a),x=/\d/.test(a),h=/[!@#$%^&*(),.?":{}|<>]/.test(a);return L&&z&&x&&h?Promise.resolve():Promise.reject("Debe contener mayúsculas, minúsculas, números y símbolos")},trigger:"blur"}],confirmPassword:[{required:!0,message:"Confirma tu nueva contraseña",trigger:"blur"},{validator:(o,a)=>!a||a===c.newPassword?Promise.resolve():Promise.reject("Las contraseñas no coinciden"),trigger:"blur"}]},oa=B(()=>`${l.name} ${l.paterno} ${l.materno}`),G=B(()=>({text:_.estado?"Firma Activa":"Firma Inactiva",color:_.estado?"green":"red"})),Z=o=>({Activo:"green",Pendiente:"orange",Inactivo:"red"})[o]||"default",J=o=>o?new Date(o).toLocaleDateString("es-ES",{day:"2-digit",month:"short",year:"numeric"}):"N/A",ra=()=>i.value=!0,la=()=>m.value=!0,na=()=>{c.currentPassword="",c.newPassword="",c.confirmPassword="",d.percent=0,d.text="",d.class="",v.value=!0},Q=async()=>{try{const o=await axios.get("/get-datos-perfil");Object.assign(l,o.data.data)}catch{p.error("Error al cargar datos de usuario")}},ia=async()=>{try{const o=await axios.get("/get-activity-log");R.value=o.data.data||[]}catch{p.error("Error al cargar actividad")}},W=async()=>{try{const o=await axios.get("/get-certificado-digital");C.value=o.data.data}catch{p.error("Error al cargar certificado")}},ca=async()=>{U.value=!0;try{const{data:o}=await axios.post("/actualizar-datos-perfil",g.value);o.success?(p.success("Perfil actualizado correctamente"),m.value=!1,await Q()):p.error(o.message||"Error al actualizar perfil")}catch{p.error("Error al actualizar perfil")}finally{U.value=!1}},da=async()=>{try{const{data:o}=await axios.post("/actualizar-estado-firma-perfil",{estado:_.estado});o.success?p.success("Perfil actualizado correctamente"):p.error(o.message||"Error al actualizar perfil")}catch{p.error("Error al actualizar estado")}},ua=async()=>{n.value=!0;try{const o=await axios.post("/crear-certificado-digital",{dni:l.dni,email:l.email,usuario:`${l.name} ${l.paterno} ${l.materno}`,rol:l.rol,departamento:"Dirección de admisión",password_p12:_.password_p12,valid_days:_.valid_days});o.data.success?(p.success(o.data.message||"Certificado creado exitosamente"),i.value=!1,await W()):p.error(o.data.message||"Error al crear certificado")}catch{p.error("Error al crear certificado")}finally{n.value=!1}},fa=async()=>{if(!c.currentPassword){p.error("Ingresa tu contraseña actual");return}if(c.newPassword!==c.confirmPassword){p.error("Las contraseñas no coinciden");return}$.value=!0;try{const{data:o}=await axios.post("(/cambiar-contrasena-perfil",{password_actual:c.currentPassword,password_nueva:c.newPassword});o.success?(p.success(o.message||"Contraseña cambiada exitosamente"),v.value=!1,c.currentPassword="",c.newPassword="",c.confirmPassword="",d.percent=0,d.text="",d.class=""):p.error(o.message||"Error al cambiar contraseña")}catch{p.error("Error al cambiar contraseña")}finally{$.value=!1}};return Y(()=>c.newPassword,o=>{if(!o){d.percent=0,d.text="",d.class="";return}let a=0;o.length>=8&&(a+=25),/[A-Z]/.test(o)&&(a+=25),/[a-z]/.test(o)&&(a+=25),/[0-9]/.test(o)&&(a+=15),/[^A-Za-z0-9]/.test(o)&&(a+=10),d.percent=Math.min(a,100),a<50?(d.text="Débil",d.class="weak"):a<75?(d.text="Media",d.class="medium"):(d.text="Fuerte",d.class="strong")}),Y(()=>l.email,o=>{_.email=o},{immediate:!0}),Q(),ia(),W(),(o,a)=>{const L=wa,z=ya,x=Pa,h=Sa,pa=Aa,I=Da,N=Ma,A=Ua,ma=$a,va=La,X=Ca,_a=Ia,D=Na,P=Fa,F=ja,ga=Va,j=Ba,V=xa,E=qa;return O(),S("div",Xa,[t("div",Ya,[e(L,{size:96,src:l.foto,class:"profile-avatar"},{default:s(()=>[e(y(k))]),_:1},8,["src"]),t("div",Ka,[t("h1",null,f(oa.value),1),t("p",ae,f(l.rol),1),t("div",ee,[e(z,{color:Z(l.estado)},{default:s(()=>[b(f(l.estado==1?"Activo":"Inactivo"),1)]),_:1},8,["color"]),e(z,{color:G.value.color},{default:s(()=>[b(f(G.value.text),1)]),_:1},8,["color"])])]),e(x,{type:"primary",onClick:ra,class:"signature-btn"},{default:s(()=>[e(y(q)),a[15]||(a[15]=b(" Certificados de Firma "))]),_:1})]),e(X,{gutter:24,class:"content-grid"},{default:s(()=>[e(A,{xs:24,md:8,lg:8},{default:s(()=>[e(N,{title:"Información Personal",class:"info-card"},{default:s(()=>[e(pa,{column:1,size:"small"},{default:s(()=>[e(h,{label:"DNI"},{default:s(()=>[b(f(l.dni),1)]),_:1}),e(h,{label:"Teléfono"},{default:s(()=>[b(f(l.celular),1)]),_:1}),e(h,{label:"Proceso"},{default:s(()=>[t("code",null,f(l.proceso),1)]),_:1}),e(h,{label:"Estado"},{default:s(()=>[e(z,{color:Z(l.estado),size:"small"},{default:s(()=>[b(f(l.estado==1?"Activo":"Inactivo"),1)]),_:1},8,["color"])]),_:1})]),_:1}),e(I),t("div",te,[e(x,{block:"",onClick:la,class:"action-btn"},{default:s(()=>[e(y(Ha)),a[16]||(a[16]=b(" Editar Perfil "))]),_:1}),e(x,{block:"",onClick:na,class:"action-btn"},{default:s(()=>[e(y(Qa)),a[17]||(a[17]=b(" Cambiar Contraseña "))]),_:1})])]),_:1}),e(N,{title:"Estadísticas",class:"stats-card"},{default:s(()=>a[18]||(a[18]=[t("div",{class:"stats-grid"},[t("div",{class:"stat-item"},[t("div",{class:"stat-value"},".-."),t("div",{class:"stat-label"},"Documentos revisados")]),t("div",{class:"stat-item"},[t("div",{class:"stat-value"},".-."),t("div",{class:"stat-label"},"Firmados")]),t("div",{class:"stat-item"},[t("div",{class:"stat-value"},".-."),t("div",{class:"stat-label"},"Certificado")])],-1)])),_:1})]),_:1}),e(A,{xs:24,md:16,lg:16},{default:s(()=>[e(N,{title:"Actividad Reciente",class:"activity-card"},{default:s(()=>[e(va,null,{default:s(()=>[(O(!0),S(ha,null,Oa(R.value,r=>(O(),ka(ma,{key:r.id,color:r.color},{default:s(()=>[t("div",se,[t("div",oe,f(r.title),1),t("div",re,f(r.description),1),t("div",le,f(r.time),1)])]),_:2},1032,["color"]))),128))]),_:1})]),_:1})]),_:1})]),_:1}),e(V,{open:i.value,"onUpdate:open":a[4]||(a[4]=r=>i.value=r),title:"Certificado Digital",footer:null,width:"520px"},{default:s(()=>[t("div",ne,[t("div",ie,[e(y(q),{class:"header-icon"}),a[19]||(a[19]=t("div",null,[t("h3",null,"Gestión de certificado digital"),t("p",null,"Creación y configuración de tu certificado personal")],-1))]),t("div",ce,[t("div",de,[e(y(q),{class:"icon"}),a[20]||(a[20]=t("h3",null,"Certificado Digital",-1))]),C.value?(O(),S("div",ue,[t("div",fe,[a[21]||(a[21]=t("span",{class:"label"},"Departamento:",-1)),t("span",pe,f(C.value.departamento||"No especificado"),1)]),t("div",me,[a[22]||(a[22]=t("span",{class:"label"},"Cargo:",-1)),t("span",ve,f(C.value.cargo||"No especificado"),1)]),t("div",_e,[a[23]||(a[23]=t("span",{class:"label"},"Vigencia:",-1)),t("span",ge,f(C.value.valid_days||"0")+" días",1)]),t("div",be,[a[24]||(a[24]=t("span",{class:"label"},"Creado:",-1)),t("span",we,f(J(C.value.fecha_creacion)),1)]),t("div",ye,[a[25]||(a[25]=t("span",{class:"label"},"Expira:",-1)),t("span",Pe,f(J(C.value.fecha_expiracion)),1)])])):(O(),S("div",Ce,a[26]||(a[26]=[t("div",{class:"field"},[t("span",{class:"label"},"Estado:"),t("span",{class:"value text-gray-500"},"No hay certificado registrado")],-1),t("div",{class:"field"},[t("span",{class:"label"},"Acción:"),t("span",{class:"value text-blue-500"},"Crea tu primer certificado")],-1)])))]),t("div",xe,[a[27]||(a[27]=t("span",{class:"label"},"Firma electrónica",-1)),t("div",null,[e(_a,{checked:_.estado,"onUpdate:checked":a[0]||(a[0]=r=>_.estado=r),onChange:da},null,8,["checked"]),t("span",{class:K(["status-text",_.estado?"activado":"desactivado"])},null,2)])]),e(I),a[31]||(a[31]=t("div",{class:"mb-2"},[t("span",{style:{"font-weight":"bold","font-size":"1.2rem"}},"Actualizar contraseña del certificado digital")],-1)),e(j,{layout:"vertical",class:"signature-form mt-0"},{default:s(()=>[e(P,{label:"Contraseña del Certificado"},{default:s(()=>[e(D,{value:_.password_p12,"onUpdate:value":a[1]||(a[1]=r=>_.password_p12=r),placeholder:"Contraseña segura"},null,8,["value"])]),_:1}),e(P,{label:"Vigencia del Certificado"},{default:s(()=>[e(ga,{value:_.valid_days,"onUpdate:value":a[2]||(a[2]=r=>_.valid_days=r)},{default:s(()=>[e(F,{value:365},{default:s(()=>a[28]||(a[28]=[b("1 año")])),_:1}),e(F,{value:730},{default:s(()=>a[29]||(a[29]=[b("2 años")])),_:1}),e(F,{value:1095},{default:s(()=>a[30]||(a[30]=[b("3 años")])),_:1})]),_:1},8,["value"])]),_:1}),e(I),e(x,{type:"primary",block:"",size:"large",loading:n.value,onClick:a[3]||(a[3]=r=>ua())},{default:s(()=>[b(f(C.value?"Actualizar Contraseña":"Crear Certificado"),1)]),_:1},8,["loading"])]),_:1})])]),_:1},8,["open"]),e(V,{open:m.value,"onUpdate:open":a[10]||(a[10]=r=>m.value=r),title:"Editar Perfil",onOk:ca,"ok-text":"Guardar cambios","cancel-text":"Cancelar","ok-button-props":{loading:U.value}},{default:s(()=>[e(j,{model:g.value,layout:"vertical"},{default:s(()=>[e(X,{gutter:16},{default:s(()=>[e(A,{xs:24,sm:12},{default:s(()=>[e(P,{label:"Nombres"},{default:s(()=>[e(E,{value:g.value.name,"onUpdate:value":a[5]||(a[5]=r=>g.value.name=r)},{prefix:s(()=>[e(y(k))]),_:1},8,["value"])]),_:1})]),_:1}),e(A,{xs:24,sm:12},{default:s(()=>[e(P,{label:"Apellido Paterno"},{default:s(()=>[e(E,{value:g.value.paterno,"onUpdate:value":a[6]||(a[6]=r=>g.value.paterno=r)},{prefix:s(()=>[e(y(k))]),_:1},8,["value"])]),_:1})]),_:1})]),_:1}),e(P,{label:"Apellido Materno"},{default:s(()=>[e(E,{value:g.value.materno,"onUpdate:value":a[7]||(a[7]=r=>g.value.materno=r)},{prefix:s(()=>[e(y(k))]),_:1},8,["value"])]),_:1}),e(P,{label:"Email"},{default:s(()=>[e(E,{value:g.value.email,"onUpdate:value":a[8]||(a[8]=r=>g.value.email=r)},{prefix:s(()=>[e(y(k))]),_:1},8,["value"])]),_:1}),e(P,{label:"Teléfono"},{default:s(()=>[e(E,{value:g.value.celular,"onUpdate:value":a[9]||(a[9]=r=>g.value.celular=r)},{prefix:s(()=>[e(y(k))]),_:1},8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["open","ok-button-props"]),e(V,{open:v.value,"onUpdate:open":a[14]||(a[14]=r=>v.value=r),title:"Cambiar Contraseña","ok-text":"Cambiar Contraseña","cancel-text":"Cancelar","ok-button-props":{loading:$.value},onOk:fa},{default:s(()=>[e(j,{ref:"passwordFormRef",model:c,rules:sa,layout:"vertical"},{default:s(()=>[e(P,{label:"Contraseña actual",name:"currentPassword"},{default:s(()=>[e(D,{value:c.currentPassword,"onUpdate:value":a[11]||(a[11]=r=>c.currentPassword=r),placeholder:"Ingresa tu contraseña actual"},null,8,["value"])]),_:1}),e(P,{label:"Nueva contraseña",name:"newPassword"},{default:s(()=>[e(D,{value:c.newPassword,"onUpdate:value":a[12]||(a[12]=r=>c.newPassword=r),placeholder:"Ingresa nueva contraseña"},null,8,["value"]),c.newPassword?(O(),S("div",he,[t("div",Oe,[t("div",{class:K(["strength-fill",d.class]),style:za({width:d.percent+"%"})},null,6)]),t("span",ke,f(d.text),1)])):Ea("",!0)]),_:1}),e(P,{label:"Confirmar contraseña",name:"confirmPassword"},{default:s(()=>[e(D,{value:c.confirmPassword,"onUpdate:value":a[13]||(a[13]=r=>c.confirmPassword=r),placeholder:"Confirma la nueva contraseña"},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["open","ok-button-props"])])}}},$e=ba(ze,[["__scopeId","data-v-c017b0e2"]]);export{$e as default};

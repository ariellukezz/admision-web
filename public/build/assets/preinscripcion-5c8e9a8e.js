import{L as Ae}from"./LayoutPreinscripcionSegundas-2407cd7e.js";import{C as z,r as l,e as G,y as u,a3 as Me,ax as Te,a5 as v,o as E,c as Le,a as A,u as o,w as ye,F as Oe,Z as qe,E as x,f as U,d as M,M as Be}from"./app-d94ab509.js";import Ve from"./IdentityValidation-1dc5ac8e.js";import Ye from"./PersonalDataForm-2d67985c.js";import Ze from"./AdditionalDataForm-6e2ee438.js";import $e from"./ProgramAndDocs-9ebf545f.js";import ze from"./SuccessMessage-5a4c7641.js";import Ge from"./NavigationButtons-049c5e16.js";import He from"./VerificationModal-01e6305f.js";import Je from"./titulo-d5e52dc1.js";import{f as Ke}from"./index-6ecaf3d6.js";import{_ as Qe}from"./_plugin-vue_export-helper-c27b6911.js";import"./logotiny-c4b525af.js";import"./LoginOutlined-3d3224c6.js";import"./AntdIcon-c56eb973.js";import"./DownOutlined-e7a41506.js";import"./DownloadOutlined-f83b0136.js";import"./LeftOutlined-782eefeb.js";import"./RightOutlined-707e2d42.js";import"./EyeOutlined-acf66a04.js";import"./es-63e3c2d1.js";const We=_=>{const p=z({dni:"",codigo_secreto:""}),b=l(null),y=l(),r=z({id:null,tipo_doc:1,primerapellido:"",segundo_apellido:"",nombres:"",estado_civil:null,sexo:null,correo:"",celular:"",fec_nacimiento:"",egreso:"",direccion:"",ubigeo_nacimiento:"",ubigeo_residencia:"",residencia:"",nacimiento:""}),g=z({discapacidad:null,tipo_discapacidad:"",id_postulante:3,id_proceso:1,id_pertenencia_cultural:null,id_pueblo_indigena:null,id_condicion_lengua:null,id_lengua_indigena:null}),c=z({modalidad:null,programa:null,tipo_certificado:null,codigo_medico:null,codigo_certificado:null});l();const f=l(),w=l(),d=l(0),D=l(!1),C=l(!0),I=l(!1),H=l(!1),P=l(0),N=l(0),T=l(0),J=l(null),F=l(null),L=l([]),S=l(null),O=l([]),q=l([]),B=l([]),R=l([]),V=l([]),Y=l([]),K={1:"DNI",2:"PASAPORTE"},Q={1:"SOLTERO",2:"CASADO",3:"VIUDO"},W={1:"MASCULINO",2:"FEMENINO"},X=e=>{p.dni=e.target.value.replace(/\D/g,"")},j=e=>{r.nombres=e.target.value.replace(/[^A-Za-z\s]/g,"")},h=e=>{r.primerapellido=e.target.value.replace(/[^A-Za-z]/g,"")},ee=e=>{r.celular=e.target.value.replace(/\D/g,"")},oe=e=>{r.correo=e.target.value},ae=(e,a)=>new Promise((s,t)=>{if(!a)t(new Error("Por favor, selecciona tu fecha de nacimiento."));else{const m=new Date(a),we=new Date;we.setFullYear(we.getFullYear()-20),m>we?t(new Error("Debes tener al menos 20 años.")):s()}}),ie=(e,a)=>new Promise((s,t)=>{a?b.value!==p.codigo_secreto?t(new Error("El código ingresado no coincide.")):s():t(new Error("Por favor, ingresa el código secreto."))}),ne=(e,a)=>new Promise((s,t)=>{a?u.post("/existe-celular",{celular:a,dni:p.dni}).then(m=>{m.data==!0?t(new Error("Este número de celular ya está registrado.")):s()}).catch(m=>{console.error("Error al verificar el número de celular:",m),t(new Error("Error al verificar el número de celular."))}):t(new Error("Por favor, ingresa tu número de celular."))}),re=(e,a)=>new Promise((s,t)=>{a?u.post("/existe-correo",{email:a,dni:p.dni}).then(m=>{m.data==!0?t(new Error("Este correo ya está registrado.")):s()}).catch(m=>{console.error("Error al verificar el correo:",m),t(new Error("Error al verificar correo."))}):t(new Error("Por favor, ingresa tu correo."))}),Z=async()=>{let e=await u.get("/generar-captcha");b.value=e.data.captcha},te=async()=>{let e=await u.post("/get-postulante-datos-personales2",{nro_doc:p.dni});if(e.data.datos.length>0){const a=e.data.datos[0];if(r.id=a.id,r.primerapellido=a.primer_apellido,r.segundo_apellido=a.segundo_apellido,r.nombres=a.nombres,r.estado_civil=a.estado_civil,r.sexo=a.sexo,r.direccion=a.direccion,r.correo=a.correo,r.celular=a.celular,r.egreso=a.egreso,r.residencia=a.residencia,r.nacimiento=a.nacimiento,a.fec_nacimiento){const s=a.fec_nacimiento.trim(),t=Me(s,"YYYY-MM-DD",!0);t.isValid()?r.fec_nacimiento=t:console.error("Fecha inválida:",s)}p.ubigeo=a.ubigeo,r.ubigeo_nacimiento=a.ubigeo,r.ubigeo_residencia=a.ubigeo_residencia}},se=async()=>{u.post("/get-ubigeo",{term:F.value}).then(e=>{L.value=e.data.datos.data}).catch(e=>{e.response?console.error("Error de servidor:",e.response.data):e.request?console.error("Error de red:",e.request):console.error("Error de configuración:",e.message)})},de=async()=>{u.post("/get-ubigeo",{term:S.value}).then(e=>{O.value=e.data.datos.data}).catch(e=>{e.response?console.error("Error de servidor:",e.response.data):e.request?console.error("Error de red:",e.request):console.error("Error de configuración:",e.message)})},$=async()=>{u.get("/get-identidad-cultural/"+r.id+"/"+_.procceso_seleccionado.id).then(e=>{g.discapacidad=e.data.discapacidad,g.tipo_discapacidad=e.data.tipo_discapacidad,g.id_condicion_lengua=e.data.id_condicion_lengua,g.id_lengua_indigena=e.data.id_lengua_indigena,g.id_pertenencia_cultural=e.data.id_pertenencia_cultural,g.id_pueblo_indigena=e.data.id_pueblo_indigena}).catch(e=>{e.response?console.error("Error de servidor:",e.response.data):e.request?console.error("Error de red:",e.request):console.error("Error de configuración:",e.message)})},ce=e=>{y.value=e},le=(e,a)=>new Promise((s,t)=>{a==null||a===""?t(new Error("¿Tiene discapacidad? es obligatorio")):s()}),ue=(e,a)=>new Promise((s,t)=>{(g.discapacidad==="1"||g.discapacidad===1)&&!a?t(new Error("Tipo de discapacidad es obligatorio")):s()}),pe=(e,a)=>new Promise((s,t)=>{a?s():t(new Error("¿Se identifica con alguna lengua indígena? es obligatorio"))}),ge=(e,a)=>new Promise((s,t)=>{const m="b57c729c-2c2e-4b07-9e01-d63ecf94ccc1";g.id_condicion_lengua&&g.id_condicion_lengua!==m&&!a?t(new Error("Lengua indígena es obligatoria si se identifica con una")):s()}),Pe=(e,a)=>new Promise((s,t)=>{a?s():t(new Error("¿Pertenece a algún pueblo indígena? es obligatorio"))}),Ee=(e,a)=>new Promise((s,t)=>{const m="47de46ba-be45-41a6-a542-6f88fcd4653c";g.id_pertenencia_cultural&&g.id_pertenencia_cultural!==m&&!a?t(new Error("Pueblo indígena es obligatorio si pertenece a uno")):s()}),De=e=>{w.value=e},me=e=>{f.value=e},_e=(e,a)=>{r.ubigeo_nacimiento=a.key},fe=(e,a)=>{r.ubigeo_residencia=a.key},ve=async()=>{if(await Te(),!y.value){v.error("Formulario no disponible");return}try{await y.value.validateFields(["ubigeo_nacimiento"]);const e=await y.value.validateFields();let a=await u.post("/save-postulante-segundas",{tipo_doc:r.tipo_doc,nro_doc:p.dni,id:r.id,primer_apellido:r.primerapellido,segundo_apellido:r.segundo_apellido,nombres:r.nombres,egreso:r.egreso,correo:r.correo,celular:r.celular,sexo:r.sexo,estado_civil:r.estado_civil,fec_nacimiento:Ke(new Date(r.fec_nacimiento),"yyyy-MM-dd"),ubigeo_nacimiento:r.ubigeo_nacimiento,ubigeo_residencia:r.ubigeo_residencia,direccion:r.direccion,proceso:_.procceso_seleccionado.id});d.value=2,a.data.estado===!0&&(v.success(a.data.mensaje),d.value=2)}catch(e){console.error("Error validating form:",e),v.error("Por favor, completa todos los campos requeridos")}},k=async()=>{if(!w.value||!w.value.validateFields){v.error("Formulario no disponible");return}try{await w.value.validateFields(),(await u.post("/save-postulante-adicional",{id_postulante:r.id,id_proceso:_.procceso_seleccionado.id,discapacidad:g.discapacidad,tipo_discapacidad:g.tipo_discapacidad,id_condicion_lengua:g.id_condicion_lengua,id_lengua_indigena:g.id_lengua_indigena,id_pertenencia_cultural:g.id_pertenencia_cultural,id_pueblo_indigena:g.id_pueblo_indigena})).data.estado===!0&&(d.value=6,v.success("Datos guardados correctamente"))}catch{v.error("Por favor, completa los campos obligatorios")}},i=async()=>{let e=await u.post("/get-select-programas-proceso-segundas",{id_modalidad:1,id_proceso:_.procceso_seleccionado.id});Y.value=e.data.datos},be=async()=>{var e,a;try{const t=(await u.get("/verificar-documentos-preinscripcion/"+p.dni+"/"+_.procceso_seleccionado.id)).data;return t.estado===!0?!0:((e=t.missing)==null?void 0:e.length)===2?(v.error("Faltal el titulo, debe estar en PDF y pesar menos de 1MB."),!1):(a=t.missing)!=null&&a.includes(7)?(v.error("Falta subir título."),!1):!0}catch(s){return console.error("Error en la validación:",s),v.error("Error al validar documentos."),!1}},n=async()=>{try{const e=await u.get("/descargar-reglamento/"+_.procceso_seleccionado.id,{responseType:"blob"}),a=window.URL.createObjectURL(new Blob([e.data])),s=document.createElement("a");s.href=a,s.setAttribute("download","reglamento.pdf"),document.body.appendChild(s),s.click()}catch(e){console.error("Error al descargar el PDF",e)}},Fe=async()=>{const e=await u.get("/get-condiciones-lengua-segundas");e.data&&(q.value=e.data)},xe=async()=>{const e=await u.get("/get-pertenencia-cultural-segundas");e.data&&(B.value=e.data)},Ue=async()=>{const e=await u.get("/get-lengua-segundas");e.data&&(R.value=e.data)},Ce=async()=>{const e=await u.get("/get-pueblos-indigenes-segundas");e.data&&(V.value=e.data)},Ne=async()=>{N.value=0;try{return(await u.get("/get-sancionado/"+p.dni+"/"+_.procceso_seleccionado.id)).data.datos}catch(e){console.error("Error al obtener datos de sancionado",e)}},Se=async()=>{P.value=0;try{let e=await u.get("/participa-proceso/"+_.procceso_seleccionado.id+"/"+p.dni);if(e.data.estado===!0)P.value=1,D.value=!1,C.value=!1,d.value=7;else return N.value=1,e.data.estado}catch(e){console.error("Error al obtener datos del participante",e)}},Ie=async()=>{let e=await u.get("/get-paso-registrado/"+_.procceso_seleccionado.id+"/"+p.dni);e.data.estado==!0?(te(),e.data.datos.nro==3||(d.value=e.data.datos.nro+1)):(D.value=!0,C.value=!0,Ne())},Re=async()=>{const e=await u.get("/get-data-prisma/"+p.dni);if(e.data.estado===!0){const a=e.data.datos;p.dni=a.dni,r.primerapellido=a.paterno,r.segundo_apellido=a.materno,r.nombres=a.nombre}C.value=!1},ke=async()=>{let e=new FormData;e.append("dni",p.dni),e.append("modalidad",1),e.append("programa",c.programa),e.append("tipo_certificado",c.tipo_certificado),e.append("codigo_certificado",c.codigo_certificado),e.append("codigo_medico",c.codigo_medico),e.append("id_postulante",r.id),e.append("id_proceso",_.procceso_seleccionado.id),await u.post("/save-pre-inscripcion",e).then(a=>{v.success(a.data.mensaje),d.value=7,P.value=1}).catch(a=>console.log(a)),I.value=!1};return G(F,e=>{e&&e.length>=3&&se()}),G(S,e=>{e&&e.length>=3&&de()}),G(()=>p.dni,e=>{e.length==8&&Ie()}),G(()=>d.value,e=>{e===2?(Fe(),xe(),Ue(),Ce(),$()):e===6&&(console.log("Cargando programas..."),i(),setTimeout(()=>{console.log("formPreinscripcion después de montar:",f.value)},100))},{immediate:!0}),Z(),{formState:p,formDatosTransversales:w,formPreinscripcion:f,codigo_aleatorio:b,formRef:y,datospersonales:r,datos_transversales:g,datos_preinscripcion:c,pagina_pre:d,modalcarrerasprevias:D,loading:C,open:I,checkbox1:H,postulante_inscrito:P,participa:N,avance:T,avance_current:J,buscarResidencia:F,residencias:L,buscarNacimiento:S,ubigeosNacimiento:O,condiciones_lengua:q,opciones_pertenencia_cultural:B,lenguas_indigenas:R,pueblos_indigenas:V,programas:Y,tipo_docs:K,estados_civil:Q,sexos:W,dniInput:X,nombresInput:j,pimerapellidoInput:h,celularInput:ee,correoInput:oe,validateFechaNacimiento:ae,validateCodigoSecreto:ie,validateCelular:ne,validateCorreo:re,validateDiscapacidad:le,validateTipoDiscapacidad:ue,validateIdCondicionLengua:pe,validateIdLenguaIndigena:ge,validateIdPertenenciaCultural:Pe,validateIdPuebloIndigena:Ee,getCodigoAleatorio:Z,getDatosPersonales:te,getInformacionAdicional:$,saveDatosPersonales:ve,saveAdditionalData:k,getProgramas:i,validateDocuments:be,descargaReglamento:n,onSelectNacimiento:_e,onSelectResidencias:fe,setFormRef:ce,setFormPreinscripcion:me,setFormDatosTransversales:De,consultaInscripcion:Se,getPasoRegistrado:Ie,getDataPrisma:Re,submit:ke}};const Xe={__name:"preinscripcion",props:["procceso_seleccionado"],setup(_){const p=_,{formState:b,codigo_aleatorio:y,formRef:r,formPreinscripcion:g,datospersonales:c,datos_transversales:f,datos_preinscripcion:w,pagina_pre:d,modalcarrerasprevias:D,loading:C,open:I,checkbox1:H,postulante_inscrito:P,participa:N,buscarResidencia:T,residencias:J,buscarNacimiento:F,ubigeosNacimiento:L,condiciones_lengua:S,opciones_pertenencia_cultural:O,lenguas_indigenas:q,pueblos_indigenas:B,programas:R,tipo_docs:V,estados_civil:Y,sexos:K,dniInput:Q,nombresInput:W,pimerapellidoInput:X,celularInput:j,correoInput:h,validateFechaNacimiento:ee,validateCodigoSecreto:oe,validateCelular:ae,validateCorreo:ie,getCodigoAleatorio:ne,getDatosPersonales:re,saveDatosPersonales:Z,getProgramas:te,validateDocuments:se,descargaReglamento:de,onSelectNacimiento:$,onSelectResidencias:ce,setFormRef:le,setFormPreinscripcion:ue,setFormDatosTransversales:pe,saveAdditionalData:ge,consultaInscripcion:Pe,getPasoRegistrado:Ee,getDataPrisma:De,submit:me}=We(p),_e=()=>{d.value===1?d.value=0:d.value===2?d.value=1:d.value===6&&(d.value=2)},fe=async()=>{d.value===1?await Z():d.value===2&&await ge()},ve=async()=>{try{if(console.log("Intentando abrir modal..."),!await se())return;I.value=!0}catch(k){console.error("Error al abrir el modal de datos:",k),v.error("Ocurrió un error al verificar los documentos.")}};return(k,i)=>{const be=Be;return E(),Le(Oe,null,[A(o(qe),{title:"Preinscripción"}),A(Ae,{nombre:p.procceso_seleccionado.nombre},{default:ye(()=>[o(d)===0?(E(),x(Ve,{key:0,formState:o(b),formRef:o(r),codigo_aleatorio:o(y),datospersonales:o(c),participa:o(N),modalcarrerasprevias:o(D),dniInput:o(Q),getCodigoAleatorio:o(ne),validateCodigoSecreto:o(oe),getDatosPersonales:o(re),onProceed:i[0]||(i[0]=n=>d.value=1),"onUpdate:dni":i[1]||(i[1]=n=>o(b).dni=n),"onUpdate:codigo_secreto":i[2]||(i[2]=n=>o(b).codigo_secreto=n),"onUpdate:tipo_doc":i[3]||(i[3]=n=>o(c).tipo_doc=n)},null,8,["formState","formRef","codigo_aleatorio","datospersonales","participa","modalcarrerasprevias","dniInput","getCodigoAleatorio","validateCodigoSecreto","getDatosPersonales"])):U("",!0),o(d)===1?(E(),x(Ye,{key:1,setFormRef:o(le),datospersonales:o(c),ubigeosNacimiento:o(L),residencias:o(J),buscarNacimiento:o(F),buscarResidencia:o(T),pimerapellidoInput:o(X),nombresInput:o(W),validateFechaNacimiento:o(ee),validateCelular:o(ae),validateCorreo:o(ie),correoInput:o(h),onSelectNacimiento:o($),onSelectResidencias:o(ce),celularInput:o(j),"onUpdate:primerapellido":i[4]||(i[4]=n=>o(c).primerapellido=n),"onUpdate:segundo_apellido":i[5]||(i[5]=n=>o(c).segundo_apellido=n),"onUpdate:nombres":i[6]||(i[6]=n=>o(c).nombres=n),"onUpdate:sexo":i[7]||(i[7]=n=>o(c).sexo=n),"onUpdate:estado_civil":i[8]||(i[8]=n=>o(c).estado_civil=n),"onUpdate:fec_nacimiento":i[9]||(i[9]=n=>o(c).fec_nacimiento=n),"onUpdate:celular":i[10]||(i[10]=n=>o(c).celular=n),"onUpdate:correo":i[11]||(i[11]=n=>o(c).correo=n),"onUpdate:direccion":i[12]||(i[12]=n=>o(c).direccion=n),"onUpdate:egreso":i[13]||(i[13]=n=>o(c).egreso=n),"onUpdate:nacimiento":i[14]||(i[14]=n=>o(c).nacimiento=n),"onUpdate:residencia":i[15]||(i[15]=n=>o(c).residencia=n),"onUpdate:buscarNacimiento":i[16]||(i[16]=n=>F.value=n),"onUpdate:buscarResidencia":i[17]||(i[17]=n=>T.value=n)},null,8,["setFormRef","datospersonales","ubigeosNacimiento","residencias","buscarNacimiento","buscarResidencia","pimerapellidoInput","nombresInput","validateFechaNacimiento","validateCelular","validateCorreo","correoInput","onSelectNacimiento","onSelectResidencias","celularInput"])):U("",!0),o(d)===2?(E(),x(Ze,{key:2,datospersonales:o(c),datos_transversales:o(f),condiciones_lengua:o(S),lenguas_indigenas:o(q),opciones_pertenencia_cultural:o(O),pueblos_indigenas:o(B),setFormDatosTransversales:o(pe),"onUpdate:discapacidad":i[18]||(i[18]=n=>o(f).discapacidad=n),"onUpdate:tipo_discapacidad":i[19]||(i[19]=n=>o(f).tipo_discapacidad=n),"onUpdate:id_condicion_lengua":i[20]||(i[20]=n=>o(f).id_condicion_lengua=n),"onUpdate:id_lengua_indigena":i[21]||(i[21]=n=>o(f).id_lengua_indigena=n),"onUpdate:id_pertenencia_cultural":i[22]||(i[22]=n=>o(f).id_pertenencia_cultural=n),"onUpdate:id_pueblo_indigena":i[23]||(i[23]=n=>o(f).id_pueblo_indigena=n)},null,8,["datospersonales","datos_transversales","condiciones_lengua","lenguas_indigenas","opciones_pertenencia_cultural","pueblos_indigenas","setFormDatosTransversales"])):U("",!0),o(d)===6?(E(),x($e,{key:3,setFormPreinscripcion:o(ue),datos_preinscripcion:o(w),programas:o(R),"onUpdate:programa":i[24]||(i[24]=n=>o(w).programa=n)},{documents:ye(()=>[A(Je,{id_proceso:p.procceso_seleccionado.id,dni:o(b).dni},null,8,["id_proceso","dni"])]),_:1},8,["setFormPreinscripcion","datos_preinscripcion","programas"])):U("",!0),o(d)===7||o(P)===1?(E(),x(ze,{key:4,onDownload:o(de)},null,8,["onDownload"])):U("",!0),o(d)!==0&&o(d)!==7&&o(P)!==1?(E(),x(Ge,{key:5,pagina_pre:o(d),onPrevious:_e,onNext:fe,onVerify:ve},null,8,["pagina_pre"])):U("",!0),A(He,{open:o(I),datospersonales:o(c),datos_preinscripcion:o(w),checkbox1:o(H),tipo_docs:o(V),estados_civil:o(Y),sexos:o(K),especialidades:o(R),formState:o(b),onClose:i[25]||(i[25]=n=>I.value=!1),onSubmit:o(me)},null,8,["open","datospersonales","datos_preinscripcion","checkbox1","tipo_docs","estados_civil","sexos","especialidades","formState","onSubmit"]),A(be,{open:o(D),centered:"",footer:null,closable:!1,maskClosable:!1},{default:ye(()=>i[26]||(i[26]=[M("div",{class:"py-12 text-center"},[M("div",{class:"inline-flex items-center justify-center w-16 h-16"},[M("div",{class:"w-12 h-12 border-4 border-blue-100 border-t-blue-600 rounded-full animate-spin"})]),M("h3",{class:"text-lg font-semibold text-gray-900 mt-6 mb-2"},"Verificando información"),M("p",{class:"text-gray-600"},"Estamos revisando sus datos en el sistema, tomará solo unos momentos.")],-1)])),_:1},8,["open"])]),_:1},8,["nombre"])],64)}}},yo=Qe(Xe,[["__scopeId","data-v-3614fe84"]]);export{yo as default};

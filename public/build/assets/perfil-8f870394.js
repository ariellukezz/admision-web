/* empty css                                                               */import{_ as va}from"./_plugin-vue_export-helper-c27b6911.js";import{a as e,r as _,C as M,H as B,e as X,o as h,c as A,d as t,w as s,t as c,a5 as d,an as _a,_ as ga,B as ba,m as wa,M as ya,u as g,b as v,F as Pa,s as xa,E as Ca,T as Y,x as ka,f as ha,ao as za,ap as Ea,g as Oa,P as Aa,l as Da,aq as Ua,ar as Ma,O as Ia,G as Sa,k as $a,U as Na,V as Fa,q as La,I as Va}from"./app-cb2b04a1.js";import{U as z}from"./UserOutlined-d22982c2.js";import{S as q}from"./SafetyCertificateOutlined-b9de7e86.js";import{E as ja}from"./EditOutlined-349992f9.js";import{A as Ba}from"./AntdIcon-03e9de4c.js";var qa={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M832 464h-68V240c0-70.7-57.3-128-128-128H388c-70.7 0-128 57.3-128 128v224h-68c-17.7 0-32 14.3-32 32v384c0 17.7 14.3 32 32 32h640c17.7 0 32-14.3 32-32V496c0-17.7-14.3-32-32-32zM332 240c0-30.9 25.1-56 56-56h248c30.9 0 56 25.1 56 56v224H332V240zm460 600H232V536h560v304zM484 701v53c0 4.4 3.6 8 8 8h40c4.4 0 8-3.6 8-8v-53a48.01 48.01 0 10-56 0z"}}]},name:"lock",theme:"outlined"};const Ta=qa;function K(y){for(var u=1;u<arguments.length;u++){var p=arguments[u]!=null?Object(arguments[u]):{},b=Object.keys(p);typeof Object.getOwnPropertySymbols=="function"&&(b=b.concat(Object.getOwnPropertySymbols(p).filter(function(P){return Object.getOwnPropertyDescriptor(p,P).enumerable}))),b.forEach(function(P){Ha(y,P,p[P])})}return y}function Ha(y,u,p){return u in y?Object.defineProperty(y,u,{value:p,enumerable:!0,configurable:!0,writable:!0}):y[u]=p,y}var T=function(u,p){var b=K({},u,p.attrs);return e(Ba,K({},b,{icon:Ta}),null)};T.displayName="LockOutlined";T.inheritAttrs=!1;const Ra=T,Ga={class:"profile-container"},Za={class:"profile-header"},Ja={class:"header-info"},Qa={class:"email"},Wa={class:"tags"},Xa={class:"quick-actions"},Ya={class:"activity-item"},Ka={class:"activity-title"},ae={class:"activity-desc"},ee={class:"activity-time"},te={class:"signature-modal"},se={class:"signature-header"},oe={class:"certificate-display"},re={class:"certificate-header"},le={key:0,class:"certificate-content"},ne={class:"field"},ie={class:"value"},ce={class:"field"},de={class:"value"},ue={class:"field"},pe={class:"value"},me={class:"field"},fe={class:"value"},ve={class:"field"},_e={class:"value expiry"},ge={key:1,class:"certificate-content empty-certificate"},be={class:"signature-status"},we={key:0,class:"password-strength"},ye={class:"strength-meter"},Pe={class:"strength-text"},xe={__name:"perfil",setup(y){const u=_(!1),p=_(!1),b=_(!1),P=_(!1);_(!0),_(!1);const I=_(!1),S=_(!1),x=_(null),l=M({dni:"",name:"",paterno:"",materno:"",email:"",celular:"",id_proceso:null,id_rol:null,rol:"",proceso:"",estado:null,foto:"https://i.pinimg.com/originals/2b/93/d8/2b93d8b64d3350b1151ac2ef05e89702.jpg"}),f=B(()=>({name:l.name,paterno:l.paterno,materno:l.materno,email:l.email,celular:l.celular})),m=M({dni:l.dni,email:l.email,usuario:`${l.name} ${l.paterno} ${l.materno}`,rol:l.rol,estado:!0,departamento:"Dirección de admisión",password_p12:"",valid_days:365}),n=M({currentPassword:"",newPassword:"",confirmPassword:""}),i=M({percent:0,text:"",class:""}),H=_([]);_([]);const aa={currentPassword:[{required:!0,message:"Ingresa tu contraseña actual",trigger:"blur"}],newPassword:[{required:!0,message:"Ingresa una nueva contraseña",trigger:"blur"},{min:8,message:"Mínimo 8 caracteres",trigger:"blur"},{validator:(o,a)=>{const $=/[A-Z]/.test(a),E=/[a-z]/.test(a),C=/\d/.test(a),k=/[!@#$%^&*(),.?":{}|<>]/.test(a);return $&&E&&C&&k?Promise.resolve():Promise.reject("Debe contener mayúsculas, minúsculas, números y símbolos")},trigger:"blur"}],confirmPassword:[{required:!0,message:"Confirma tu nueva contraseña",trigger:"blur"},{validator:(o,a)=>!a||a===n.newPassword?Promise.resolve():Promise.reject("Las contraseñas no coinciden"),trigger:"blur"}]},ea=B(()=>`${l.name} ${l.paterno} ${l.materno}`),R=B(()=>({text:m.estado?"Firma Activa":"Firma Inactiva",color:m.estado?"green":"red"})),G=o=>({Activo:"green",Pendiente:"orange",Inactivo:"red"})[o]||"default",Z=o=>o?new Date(o).toLocaleDateString("es-ES",{day:"2-digit",month:"short",year:"numeric"}):"N/A",ta=()=>p.value=!0,sa=()=>b.value=!0,oa=()=>{n.currentPassword="",n.newPassword="",n.confirmPassword="",i.percent=0,i.text="",i.class="",P.value=!0},J=async()=>{try{const o=await axios.get("/get-datos-perfil");Object.assign(l,o.data.data)}catch{d.error("Error al cargar datos de usuario")}},ra=async()=>{try{const o=await axios.get("/get-activity-log");H.value=o.data.data||[]}catch{d.error("Error al cargar actividad")}},Q=async()=>{try{const o=await axios.get("/get-certificado-digital");x.value=o.data.data}catch{d.error("Error al cargar certificado")}},la=async()=>{I.value=!0;try{const{data:o}=await axios.post("/actualizar-datos-perfil",f.value);o.success?(d.success("Perfil actualizado correctamente"),b.value=!1,await J()):d.error(o.message||"Error al actualizar perfil")}catch{d.error("Error al actualizar perfil")}finally{I.value=!1}},na=async()=>{try{const{data:o}=await axios.post("/actualizar-estado-firma-perfil",{estado:m.estado});o.success?d.success("Perfil actualizado correctamente"):d.error(o.message||"Error al actualizar perfil")}catch{d.error("Error al actualizar estado")}},ia=async()=>{u.value=!0;try{const o=await axios.post("/crear-certificado-digital",{dni:l.dni,email:l.email,usuario:`${l.name} ${l.paterno} ${l.materno}`,rol:l.rol,departamento:"Dirección de admisión",password_p12:m.password_p12,valid_days:m.valid_days});o.data.success?(d.success(o.data.message||"Certificado creado exitosamente"),p.value=!1,await Q()):d.error(o.data.message||"Error al crear certificado")}catch{d.error("Error al crear certificado")}finally{u.value=!1}},ca=async()=>{if(!n.currentPassword){d.error("Ingresa tu contraseña actual");return}if(n.newPassword!==n.confirmPassword){d.error("Las contraseñas no coinciden");return}S.value=!0;try{const{data:o}=await axios.post("(/cambiar-contrasena-perfil",{password_actual:n.currentPassword,password_nueva:n.newPassword});o.success?(d.success(o.message||"Contraseña cambiada exitosamente"),P.value=!1,n.currentPassword="",n.newPassword="",n.confirmPassword="",i.percent=0,i.text="",i.class=""):d.error(o.message||"Error al cambiar contraseña")}catch{d.error("Error al cambiar contraseña")}finally{S.value=!1}};return X(()=>n.newPassword,o=>{if(!o){i.percent=0,i.text="",i.class="";return}let a=0;o.length>=8&&(a+=25),/[A-Z]/.test(o)&&(a+=25),/[a-z]/.test(o)&&(a+=25),/[0-9]/.test(o)&&(a+=15),/[^A-Za-z0-9]/.test(o)&&(a+=10),i.percent=Math.min(a,100),a<50?(i.text="Débil",i.class="weak"):a<75?(i.text="Media",i.class="medium"):(i.text="Fuerte",i.class="strong")}),X(()=>l.email,o=>{m.email=o},{immediate:!0}),J(),ra(),Q(),(o,a)=>{const $=_a,E=ga,C=ba,k=za,da=Ea,N=Oa,F=Aa,D=Da,ua=Ua,pa=Ma,W=wa,ma=Ia,U=Sa,w=$a,L=Na,fa=Fa,V=La,j=ya,O=Va;return h(),A("div",Ga,[t("div",Za,[e($,{size:96,src:l.foto,class:"profile-avatar"},{default:s(()=>[e(g(z))]),_:1},8,["src"]),t("div",Ja,[t("h1",null,c(ea.value),1),t("p",Qa,c(l.rol),1),t("div",Wa,[e(E,{color:G(l.estado)},{default:s(()=>[v(c(l.estado==1?"Activo":"Inactivo"),1)]),_:1},8,["color"]),e(E,{color:R.value.color},{default:s(()=>[v(c(R.value.text),1)]),_:1},8,["color"])])]),e(C,{type:"primary",onClick:ta,class:"signature-btn"},{default:s(()=>[e(g(q)),a[15]||(a[15]=v(" Certificados de Firma "))]),_:1})]),e(W,{gutter:24,class:"content-grid"},{default:s(()=>[e(D,{xs:24,md:8,lg:8},{default:s(()=>[e(F,{title:"Información Personal",class:"info-card"},{default:s(()=>[e(da,{column:1,size:"small"},{default:s(()=>[e(k,{label:"DNI"},{default:s(()=>[v(c(l.dni),1)]),_:1}),e(k,{label:"Teléfono"},{default:s(()=>[v(c(l.celular),1)]),_:1}),e(k,{label:"Proceso"},{default:s(()=>[t("code",null,c(l.proceso),1)]),_:1}),e(k,{label:"Estado"},{default:s(()=>[e(E,{color:G(l.estado),size:"small"},{default:s(()=>[v(c(l.estado==1?"Activo":"Inactivo"),1)]),_:1},8,["color"])]),_:1})]),_:1}),e(N),t("div",Xa,[e(C,{block:"",onClick:sa,class:"action-btn"},{default:s(()=>[e(g(ja)),a[16]||(a[16]=v(" Editar Perfil "))]),_:1}),e(C,{block:"",onClick:oa,class:"action-btn"},{default:s(()=>[e(g(Ra)),a[17]||(a[17]=v(" Cambiar Contraseña "))]),_:1})])]),_:1}),e(F,{title:"Estadísticas",class:"stats-card"},{default:s(()=>a[18]||(a[18]=[t("div",{class:"stats-grid"},[t("div",{class:"stat-item"},[t("div",{class:"stat-value"},".-."),t("div",{class:"stat-label"},"Documentos revisados")]),t("div",{class:"stat-item"},[t("div",{class:"stat-value"},".-."),t("div",{class:"stat-label"},"Firmados")]),t("div",{class:"stat-item"},[t("div",{class:"stat-value"},".-."),t("div",{class:"stat-label"},"Certificado")])],-1)])),_:1})]),_:1}),e(D,{xs:24,md:16,lg:16},{default:s(()=>[e(F,{title:"Actividad Reciente",class:"activity-card"},{default:s(()=>[e(pa,null,{default:s(()=>[(h(!0),A(Pa,null,xa(H.value,r=>(h(),Ca(ua,{key:r.id,color:r.color},{default:s(()=>[t("div",Ya,[t("div",Ka,c(r.title),1),t("div",ae,c(r.description),1),t("div",ee,c(r.time),1)])]),_:2},1032,["color"]))),128))]),_:1})]),_:1})]),_:1})]),_:1}),e(j,{open:p.value,"onUpdate:open":a[4]||(a[4]=r=>p.value=r),title:"Certificado Digital",footer:null,width:"520px"},{default:s(()=>[t("div",te,[t("div",se,[e(g(q),{class:"header-icon"}),a[19]||(a[19]=t("div",null,[t("h3",null,"Gestión de certificado digital"),t("p",null,"Creación y configuración de tu certificado personal")],-1))]),t("div",oe,[t("div",re,[e(g(q),{class:"icon"}),a[20]||(a[20]=t("h3",null,"Certificado Digital",-1))]),x.value?(h(),A("div",le,[t("div",ne,[a[21]||(a[21]=t("span",{class:"label"},"Departamento:",-1)),t("span",ie,c(x.value.departamento||"No especificado"),1)]),t("div",ce,[a[22]||(a[22]=t("span",{class:"label"},"Cargo:",-1)),t("span",de,c(x.value.cargo||"No especificado"),1)]),t("div",ue,[a[23]||(a[23]=t("span",{class:"label"},"Vigencia:",-1)),t("span",pe,c(x.value.valid_days||"0")+" días",1)]),t("div",me,[a[24]||(a[24]=t("span",{class:"label"},"Creado:",-1)),t("span",fe,c(Z(x.value.fecha_creacion)),1)]),t("div",ve,[a[25]||(a[25]=t("span",{class:"label"},"Expira:",-1)),t("span",_e,c(Z(x.value.fecha_expiracion)),1)])])):(h(),A("div",ge,a[26]||(a[26]=[t("div",{class:"field"},[t("span",{class:"label"},"Estado:"),t("span",{class:"value text-gray-500"},"No hay certificado registrado")],-1),t("div",{class:"field"},[t("span",{class:"label"},"Acción:"),t("span",{class:"value text-blue-500"},"Crea tu primer certificado")],-1)])))]),t("div",be,[a[27]||(a[27]=t("span",{class:"label"},"Firma electrónica",-1)),t("div",null,[e(ma,{checked:m.estado,"onUpdate:checked":a[0]||(a[0]=r=>m.estado=r),onChange:na},null,8,["checked"]),t("span",{class:Y(["status-text",m.estado?"activado":"desactivado"])},null,2)])]),e(N),a[31]||(a[31]=t("div",{class:"mb-2"},[t("span",{style:{"font-weight":"bold","font-size":"1.2rem"}},"Actualizar contraseña del certificado digital")],-1)),e(V,{layout:"vertical",class:"signature-form mt-0"},{default:s(()=>[e(w,{label:"Contraseña del Certificado"},{default:s(()=>[e(U,{value:m.password_p12,"onUpdate:value":a[1]||(a[1]=r=>m.password_p12=r),placeholder:"Contraseña segura"},null,8,["value"])]),_:1}),e(w,{label:"Vigencia del Certificado"},{default:s(()=>[e(fa,{value:m.valid_days,"onUpdate:value":a[2]||(a[2]=r=>m.valid_days=r)},{default:s(()=>[e(L,{value:365},{default:s(()=>a[28]||(a[28]=[v("1 año")])),_:1}),e(L,{value:730},{default:s(()=>a[29]||(a[29]=[v("2 años")])),_:1}),e(L,{value:1095},{default:s(()=>a[30]||(a[30]=[v("3 años")])),_:1})]),_:1},8,["value"])]),_:1}),e(N),e(C,{type:"primary",block:"",size:"large",loading:u.value,onClick:a[3]||(a[3]=r=>ia())},{default:s(()=>[v(c(x.value?"Actualizar Contraseña":"Crear Certificado"),1)]),_:1},8,["loading"])]),_:1})])]),_:1},8,["open"]),e(j,{open:b.value,"onUpdate:open":a[10]||(a[10]=r=>b.value=r),title:"Editar Perfil",onOk:la,"ok-text":"Guardar cambios","cancel-text":"Cancelar","ok-button-props":{loading:I.value}},{default:s(()=>[e(V,{model:f.value,layout:"vertical"},{default:s(()=>[e(W,{gutter:16},{default:s(()=>[e(D,{xs:24,sm:12},{default:s(()=>[e(w,{label:"Nombres"},{default:s(()=>[e(O,{value:f.value.name,"onUpdate:value":a[5]||(a[5]=r=>f.value.name=r)},{prefix:s(()=>[e(g(z))]),_:1},8,["value"])]),_:1})]),_:1}),e(D,{xs:24,sm:12},{default:s(()=>[e(w,{label:"Apellido Paterno"},{default:s(()=>[e(O,{value:f.value.paterno,"onUpdate:value":a[6]||(a[6]=r=>f.value.paterno=r)},{prefix:s(()=>[e(g(z))]),_:1},8,["value"])]),_:1})]),_:1})]),_:1}),e(w,{label:"Apellido Materno"},{default:s(()=>[e(O,{value:f.value.materno,"onUpdate:value":a[7]||(a[7]=r=>f.value.materno=r)},{prefix:s(()=>[e(g(z))]),_:1},8,["value"])]),_:1}),e(w,{label:"Email"},{default:s(()=>[e(O,{value:f.value.email,"onUpdate:value":a[8]||(a[8]=r=>f.value.email=r)},{prefix:s(()=>[e(g(z))]),_:1},8,["value"])]),_:1}),e(w,{label:"Teléfono"},{default:s(()=>[e(O,{value:f.value.celular,"onUpdate:value":a[9]||(a[9]=r=>f.value.celular=r)},{prefix:s(()=>[e(g(z))]),_:1},8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["open","ok-button-props"]),e(j,{open:P.value,"onUpdate:open":a[14]||(a[14]=r=>P.value=r),title:"Cambiar Contraseña","ok-text":"Cambiar Contraseña","cancel-text":"Cancelar","ok-button-props":{loading:S.value},onOk:ca},{default:s(()=>[e(V,{ref:"passwordFormRef",model:n,rules:aa,layout:"vertical"},{default:s(()=>[e(w,{label:"Contraseña actual",name:"currentPassword"},{default:s(()=>[e(U,{value:n.currentPassword,"onUpdate:value":a[11]||(a[11]=r=>n.currentPassword=r),placeholder:"Ingresa tu contraseña actual"},null,8,["value"])]),_:1}),e(w,{label:"Nueva contraseña",name:"newPassword"},{default:s(()=>[e(U,{value:n.newPassword,"onUpdate:value":a[12]||(a[12]=r=>n.newPassword=r),placeholder:"Ingresa nueva contraseña"},null,8,["value"]),n.newPassword?(h(),A("div",we,[t("div",ye,[t("div",{class:Y(["strength-fill",i.class]),style:ka({width:i.percent+"%"})},null,6)]),t("span",Pe,c(i.text),1)])):ha("",!0)]),_:1}),e(w,{label:"Confirmar contraseña",name:"confirmPassword"},{default:s(()=>[e(U,{value:n.confirmPassword,"onUpdate:value":a[13]||(a[13]=r=>n.confirmPassword=r),placeholder:"Confirma la nueva contraseña"},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["open","ok-button-props"])])}}},De=va(xe,[["__scopeId","data-v-c017b0e2"]]);export{De as default};

import{a as e,a4 as oe,a3 as v,r as u,e as B,o as m,c as g,u as b,w as n,F as ie,y as S,n as R,Z as le,d as x,b as y,t as I,f as D,E as z,a5 as M,B as se,I as re,_ as ce,h as ue,i as de,O as me,k as pe,l as _e,W as fe,a6 as ve,m as ge,q as be,M as xe}from"./app-d59ad026.js";import{_ as ye}from"./AuthenticatedLayout-9600519d.js";import"./es-3258e6b2.js";import{_ as he}from"./_plugin-vue_export-helper-c27b6911.js";import{L as we}from"./LinkOutlined-daecf4f6.js";import{A as ke}from"./AntdIcon-fb17ae9a.js";import{U as De}from"./UploadOutlined-2aa7aa56.js";import{S as Oe}from"./SearchOutlined-34791e28.js";import{F as Fe}from"./FormOutlined-d0343b20.js";import{D as Ye}from"./DeleteOutlined-d4ea6ae4.js";import"./logotiny-c4b525af.js";import"./Header-bea2c992.js";import"./perfil-81e8a979.js";/* empty css                                                               */import"./UserOutlined-fc2e5cab.js";import"./EditOutlined-8ce5359b.js";import"./DownOutlined-562c666f.js";/* empty css                                                            */function V(d){for(var s=1;s<arguments.length;s++){var r=arguments[s]!=null?Object(arguments[s]):{},p=Object.keys(r);typeof Object.getOwnPropertySymbols=="function"&&(p=p.concat(Object.getOwnPropertySymbols(r).filter(function(f){return Object.getOwnPropertyDescriptor(r,f).enumerable}))),p.forEach(function(f){Ie(d,f,r[f])})}return d}function Ie(d,s,r){return s in d?Object.defineProperty(d,s,{value:r,enumerable:!0,configurable:!0,writable:!0}):d[s]=r,d}var P=function(s,r){var p=V({},s,r.attrs);return e(ke,V({},p,{icon:oe}),null)};P.displayName="FileOutlined";P.inheritAttrs=!1;const Me=P;const Ce={class:"bg-white overflow-hidden shadow-sm sm:rounded-lg p-4",style:{height:"calc(100vh - 103px)"}},Ee={class:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-4"},Se={class:"w-full md:w-auto relative flex-1 max-w-[300px]"},Re={class:"mb-4"},Pe={key:0,class:"text-sm"},Ue={key:2,class:"flex justify-center"},Ne={key:1,class:"text-gray-300"},je={key:3,class:"flex justify-center"},Be={key:4,class:"flex gap-2"},ze={class:"flex justify-end"},Ve={class:"flex justify-end mb-4"},$e={key:0,class:"mt-4"},Ae=["src"],Le={__name:"index",setup(d){v.locale("es");const s=u(""),r=u(1),p=u(50),f=u(0),h=u(!1),U=u([]);u([]);const w=u(""),o=u({id:null,nombre:"",estado:!0,inicio_vigencia:null,fin_vigencia:null,file:null}),C=u(),$=[{title:"Nombre",dataIndex:"nombre",width:"40%"},{title:"Versión",dataIndex:"version",align:"center",width:"100px"},{title:"Vigencia",dataIndex:"vigencia",align:"center",width:"150px"},{title:"Estado",dataIndex:"estado",align:"center",width:"100px"},{title:"Acciones",dataIndex:"acciones",align:"center",width:"150px"}],A={nombre:[{required:!0,message:"El nombre es obligatorio"}]};function L(a,t){let i;return function(..._){clearTimeout(i),i=setTimeout(()=>a.apply(this,_),t)}}const O=async()=>{try{const a=await S.post("get-reglamentos",{params:{search:s.value,page:r.value,per_page:p.value}});U.value=a.data.datos.data,f.value=a.data.datos.total}catch(a){console.error("Error fetching regulations:",a),R.error({message:"Error",description:"No se pudo cargar la lista de reglamentos"})}},T=()=>{h.value=!0},q=a=>{const t=a.type==="application/pdf"||a.name.toLowerCase().endsWith(".pdf"),i=a.size/1024/1024<2;if(!t)return M.error("Solo se permiten archivos PDF!"),!1;if(!i)return M.error("El archivo debe ser menor a 2MB!"),!1;const _=new FileReader;return _.onload=k=>{w.value=k.target.result,o.value.file=a},_.readAsDataURL(a),!1},W=()=>{w.value="",o.value.file=null},G=a=>{o.value={...a,estado:a.estado===1,id:a.id,inicio_vigencia:a.inicio_vigencia?v(a.inicio_vigencia):null,fin_vigencia:a.fin_vigencia?v(a.fin_vigencia):null},w.value=a.url,h.value=!0},Z=async()=>{var a,t;try{await C.value.validate();const i=new FormData;i.append("nombre",o.value.nombre),i.append("estado",o.value.estado?1:0),o.value.id&&i.append("id",o.value.id),o.value.inicio_vigencia&&i.append("inicio_vigencia",v(o.value.inicio_vigencia).format("YYYY-MM-DD")),o.value.fin_vigencia&&i.append("fin_vigencia",v(o.value.fin_vigencia).format("YYYY-MM-DD")),o.value.file&&i.append("file",o.value.file),await S({method:"post",url:"save-reglamento",data:i,headers:{"Content-Type":"multipart/form-data"}}),M.success("Reglamento guardado exitosamente!"),h.value=!1,O(),E()}catch(i){console.error("Error saving regulation:",i),R.error({message:"Error",description:((t=(a=i.response)==null?void 0:a.data)==null?void 0:t.message)||"Ocurrió un error al guardar"})}},H=async a=>{try{await S.get(`eliminar-reglamento/${a.id}`),M.success("Reglamento eliminado exitosamente!"),O()}catch(t){console.error("Error deleting regulation:",t),R.error({message:"Error",description:"No se pudo eliminar el reglamento"})}},E=()=>{var a;(a=C.value)==null||a.resetFields(),o.value={id:null,nombre:"",estado:!0,inicio_vigencia:null,fin_vigencia:null,file:null},w.value="",h.value=!1},J=(a,t)=>!a||!t?"":`${v(a).format("DD/MM/YY")} - ${v(t).format("DD/MM/YY")}`;return B(s,L(O,300)),B(r,O),O(),(a,t)=>{const i=se,_=re,k=ce,Q=ue,X=de,K=me,F=pe,Y=_e,N=fe,ee=ve,ae=ge,te=be,ne=xe;return m(),g(ie,null,[e(b(le),{title:"Procesos"}),e(ye,null,{default:n(()=>[x("div",Ce,[x("div",Ee,[e(i,{type:"primary",class:"w-full md:w-auto rounded-md bg-[#476175] hover:bg-[#3a5165] transition-colors",onClick:T},{default:n(()=>t[7]||(t[7]=[y(" Nuevo ")])),_:1}),x("div",Se,[e(_,{value:s.value,"onUpdate:value":t[0]||(t[0]=l=>s.value=l),placeholder:"Buscar",class:"w-full pl-3"},{prefix:n(()=>[e(b(Oe),{class:"text-gray-400"})]),_:1},8,["value"])])]),x("div",Re,[e(Q,{columns:$,"data-source":U.value,pagination:!1,size:"small",scroll:{x:380,y:"calc(100vh - 240px)"},class:"custom-table"},{bodyCell:n(({column:l,record:c})=>[l.dataIndex==="nombre"?(m(),g("span",Pe,I(c.nombre),1)):D("",!0),l.dataIndex==="version"?(m(),z(k,{key:1,color:"pink"},{default:n(()=>[y("V. "+I(c.version)+".0",1)]),_:2},1024)):D("",!0),l.dataIndex==="vigencia"?(m(),g("div",Ue,[c.vigencia?(m(),z(k,{key:0,color:"blue"},{default:n(()=>[y(I(J(c.inicio_vigencia,c.fin_vigencia)),1)]),_:2},1024)):(m(),g("span",Ne,"sin vigencia"))])):D("",!0),l.dataIndex==="estado"?(m(),g("div",je,[e(k,{color:c.estado?"blue":"red"},{default:n(()=>[y(I(c.estado?"activo":"inactivo"),1)]),_:2},1032,["color"])])):D("",!0),l.dataIndex==="acciones"?(m(),g("div",Be,[e(i,{onClick:j=>a.viewDetails(c),size:"small",class:"action-btn view-btn"},{default:n(()=>[e(b(we))]),_:2},1032,["onClick"]),e(i,{onClick:j=>G(c),size:"small",class:"action-btn edit-btn"},{default:n(()=>[e(b(Fe))]),_:2},1032,["onClick"]),e(i,{onClick:j=>H(c),size:"small",class:"action-btn delete-btn"},{default:n(()=>[e(b(Ye))]),_:2},1032,["onClick"])])):D("",!0)]),_:1},8,["data-source"])]),x("div",ze,[e(X,{current:r.value,"onUpdate:current":t[1]||(t[1]=l=>r.value=l),simple:"",pageSize:p.value,total:f.value},null,8,["current","pageSize","total"])])]),e(ne,{open:h.value,"onUpdate:open":t[6]||(t[6]=l=>h.value=l),title:o.value.id?"Editar Reglamento":"Nuevo Reglamento",width:"800px",onCancel:E},{footer:n(()=>[e(i,{onClick:E},{default:n(()=>t[9]||(t[9]=[y("Cancelar")])),_:1}),e(i,{type:"primary",onClick:Z},{default:n(()=>t[10]||(t[10]=[y("Guardar")])),_:1})]),default:n(()=>[e(te,{ref_key:"formRef",ref:C,model:o.value,rules:A,layout:"vertical"},{default:n(()=>[x("div",Ve,[e(F,{label:"Estado",name:"estado"},{default:n(()=>[e(K,{checked:o.value.estado,"onUpdate:checked":t[2]||(t[2]=l=>o.value.estado=l)},null,8,["checked"])]),_:1})]),e(ae,{gutter:[16,16]},{default:n(()=>[e(Y,{span:24},{default:n(()=>[e(F,{label:"Nombre",name:"nombre",rules:[{required:!0,message:"Este campo es obligatorio"}]},{default:n(()=>[e(_,{value:o.value.nombre,"onUpdate:value":t[3]||(t[3]=l=>o.value.nombre=l),placeholder:"Ingrese el nombre del reglamento"},{prefix:n(()=>[e(b(Me))]),_:1},8,["value"])]),_:1})]),_:1}),e(Y,{span:12},{default:n(()=>[e(F,{label:"Inicio vigencia",name:"inicio_vigencia"},{default:n(()=>[e(N,{value:o.value.inicio_vigencia,"onUpdate:value":t[4]||(t[4]=l=>o.value.inicio_vigencia=l),format:"DD/MM/YYYY",style:{width:"100%"},placeholder:"Seleccione fecha"},null,8,["value"])]),_:1})]),_:1}),e(Y,{span:12},{default:n(()=>[e(F,{label:"Fin vigencia",name:"fin_vigencia"},{default:n(()=>[e(N,{value:o.value.fin_vigencia,"onUpdate:value":t[5]||(t[5]=l=>o.value.fin_vigencia=l),format:"DD/MM/YYYY",style:{width:"100%"},placeholder:"Seleccione fecha"},null,8,["value"])]),_:1})]),_:1}),e(Y,{span:24},{default:n(()=>[e(F,{label:"Archivo PDF (Máx. 2MB)",name:"file"},{default:n(()=>[e(ee,{"file-list":o.value.file?[o.value.file]:[],"before-upload":q,onRemove:W,accept:".pdf","max-count":1},{default:n(()=>[e(i,null,{default:n(()=>[e(b(De)),t[8]||(t[8]=y(" Seleccionar archivo "))]),_:1})]),_:1},8,["file-list"]),w.value?(m(),g("div",$e,[x("embed",{src:w.value,type:"application/pdf",width:"100%",height:"300px"},null,8,Ae)])):D("",!0)]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["open","title"])]),_:1})],64)}}},ra=he(Le,[["__scopeId","data-v-c2509e01"]]);export{ra as default};

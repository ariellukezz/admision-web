import{c as s,a as d,u as g,w as l,F as v,M as _,o as n,X as y,d as i,O as C,f as p,b as A,g as u}from"./app-2d57e628.js";import{A as b}from"./AuthenticatedLayout-845ff404.js";import"./DropdownLink-2765c004.js";import"./_plugin-vue_export-helper-c27b6911.js";import"./logotiny-c4b525af.js";const P={class:"flex",style:{padding:"20px"}},w={ref:"captureContainer",style:{position:"relative"}},x={ref:"videoElement",autoplay:""},k={key:1,class:"flex justify-center",style:{"margin-top":"-50px"}},E={key:0,style:{"margin-bottom":"-40px"}},$=["src"],L={key:0,class:"flex justify-between mt-3",style:{padding:"0px 20px"}},T={style:{width:"300px"}},V={data(){return{dni:null,capturedPhoto:null,cropAreaTop:0,cropAreaLeft:105,cropAreaWidth:430,cropAreaHeight:480,cargando:!1}},watch:{dni(t,e){this.dni.length===8&&this.capturePhoto()}},mounted(){this.initializeCamera()},beforeUnmount(){this.stopCamera()},methods:{async initializeCamera(){try{const t={video:!0},e=await navigator.mediaDevices.getUserMedia(t);this.$refs.videoElement.srcObject=e,this.cargando=!0}catch(t){console.error("Error al acceder a la cámara: ",t)}},stopCamera(){const t=this.$refs.videoElement.srcObject;t&&t.getTracks().forEach(e=>e.stop())},capturePhoto(){const t=this.$refs.videoElement,e=document.createElement("canvas"),c=e.getContext("2d"),o=this.$refs.cropArea,a=o.offsetWidth,r=o.offsetHeight,h=o.offsetLeft-t.offsetLeft,f=o.offsetTop-t.offsetTop;e.width=a,e.height=r,c.drawImage(t,h,f,a,r,0,0,a,r);const m=e.toDataURL();this.capturedPhoto=m,this.saveCroppedPhoto()},saveCroppedPhoto(){this.capturedPhoto&&_.post("guardar-foto-inscripcion",{dni:this.dni,photo:this.capturedPhoto}).then(t=>{console.log("Foto recortada guardada correctamente")}).catch(t=>{console.error("Error al guardar la foto recortada: ",t)})}}},O=Object.assign(V,{__name:"foto",setup(t){return(e,c)=>{const o=u("a-button"),a=u("a-input");return n(),s(v,null,[d(g(y),{title:"Inscripciones-impresión"}),d(b,null,{default:l(()=>[i("div",P,[i("div",w,[i("video",x,null,512),e.cargando===!0?(n(),s("div",{key:0,ref:"cropArea",style:C(`position: absolute; top: ${e.cropAreaTop}px; left: ${e.cropAreaLeft}px; width: ${e.cropAreaWidth}px; height: ${e.cropAreaHeight}px; border: 1px dashed blue;`)},null,4)):p("",!0),e.cargando===!0?(n(),s("div",k,[d(o,{type:"primary",onClick:e.capturePhoto},{default:l(()=>[A("Capturar Foto")]),_:1},8,["onClick"])])):p("",!0)],512),e.capturedPhoto?(n(),s("div",E,[i("img",{src:e.capturedPhoto,alt:"Foto Capturada"},null,8,$)])):p("",!0)]),e.cargando===!0?(n(),s("div",L,[i("div",T,[d(a,{value:e.dni,"onUpdate:value":c[0]||(c[0]=r=>e.dni=r),placeholder:"Ingrese DNI"},null,8,["value"])])])):p("",!0)]),_:1})],64)}}});export{O as default};

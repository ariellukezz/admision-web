import{r as c,C as h,D as L,o as m,c as I,a,u as g,w as t,F as b,y as D,n as y,Z,d,b as i,E as M,t as _,f as x,B as H,I as J,_ as K,h as Q,i as W,k as X,S as Y,j as ee,G as ae,q as te,M as oe}from"./app-d94ab509.js";import{_ as ne}from"./AuthenticatedLayout-c745db55.js";import{P as le}from"./PlusOutlined-be86ead5.js";import{S as se}from"./SearchOutlined-f387212c.js";import{E as ie}from"./EditOutlined-7757bf87.js";import{D as re}from"./DeleteOutlined-7dacb522.js";import"./logotiny-c4b525af.js";import"./Header-05192c94.js";import"./AntdIcon-c56eb973.js";import"./perfil-2cd2fa85.js";/* empty css                                                               */import"./_plugin-vue_export-helper-c27b6911.js";import"./UserOutlined-deee76e7.js";import"./SafetyCertificateOutlined-17e2c446.js";import"./DownOutlined-e7a41506.js";/* empty css                                                            */const de={class:"bg-white overflow-hidden shadow-sm sm:rounded-lg p-4"},ue={class:"mr-3"},pe={class:"flex justify-between",style:{position:"relative"}},ce={class:"mr-2",style:{position:"absolute",left:"8px",top:"3px"}},me={class:"text-gray-500"},_e={class:"mt-4"},Se={__name:"index",setup(ve){const w=c(""),N=c(1),A=c(0),k=c(!1),u=c(!1),O=c([]),n=h({id:null,dni:"",usuario:"",departamento:"",email:"",password_p12:"",activo:!0}),S=[{title:"DNI",dataIndex:"dni",width:100},{title:"Usuario / Email",dataIndex:"usuario"},{title:"Departamento",dataIndex:"departamento",width:150},{title:"Estado",dataIndex:"activo",width:100,align:"center"},{title:"Acciones",dataIndex:"acciones",width:100,align:"center"}],v=async()=>{k.value=!0;try{const l=await D.get("/admin/certificados",{params:{page:N.value,search:w.value}});O.value=l.data.data.data,A.value=l.data.data.total}catch{y.error({message:"Error",description:"No se pudieron cargar las credenciales"})}finally{k.value=!1}},B=()=>{Object.assign(n,{id:null,dni:"",usuario:"",departamento:"",email:"",password_p12:"",activo:!0}),u.value=!0},q=l=>{Object.assign(n,l),n.password_p12="",u.value=!0},$=async()=>{var l,e;try{const s=n.id?`/admin/certificados/${n.id}`:"/admin/certificados",p=n.id?"put":"post",C=await D[p](s,n);C.data.success&&(y.success({message:"Éxito",description:C.data.message}),v(),u.value=!1)}catch(s){y.error({message:"Error",description:((e=(l=s.response)==null?void 0:l.data)==null?void 0:e.message)||"Error guardando"})}},j=async l=>{try{await D.delete(`/admin/certificados/${l.id}`),y.success({message:"Éxito",description:"Credencial eliminada"}),v()}catch{y.error({message:"Error",description:"Error eliminando"})}};return v(),(l,e)=>{const s=H,p=J,C=L("row"),U=K,z=Q,F=W,f=X,E=Y,T=ee,V=ae,G=te,P=oe;return m(),I(b,null,[a(g(Z),{title:"Credenciales de Firma"}),a(ne,null,{default:t(()=>[d("div",de,[a(C,{class:"flex justify-between mb-4"},{default:t(()=>[d("div",ue,[a(s,{type:"primary",style:{"border-radius":"5px",background:"#476175"},onClick:B},{icon:t(()=>[a(g(le))]),default:t(()=>[e[9]||(e[9]=i(" Nueva Credencial "))]),_:1})]),d("div",pe,[a(p,{type:"text",placeholder:"Buscar por DNI o Usuario",value:w.value,"onUpdate:value":e[0]||(e[0]=o=>w.value=o),style:{"max-width":"300px","padding-left":"30px"},onPressEnter:v},null,8,["value"]),d("div",ce,[a(g(se))])])]),_:1}),a(z,{columns:S,"data-source":O.value,pagination:!1,size:"small",loading:k.value},{bodyCell:t(({column:o,record:r})=>[o.dataIndex==="dni"?(m(),M(U,{key:0,color:"blue"},{default:t(()=>[i(_(r.dni),1)]),_:2},1024)):x("",!0),o.dataIndex==="usuario"?(m(),I(b,{key:1},[d("strong",null,_(r.usuario),1),e[10]||(e[10]=d("br",null,null,-1)),d("small",me,_(r.email),1)],64)):x("",!0),o.dataIndex==="departamento"?(m(),I(b,{key:2},[i(_(r.departamento),1)],64)):x("",!0),o.dataIndex==="activo"?(m(),M(U,{key:3,color:r.activo?"green":"red"},{default:t(()=>[i(_(r.activo?"Activo":"Inactivo"),1)]),_:2},1032,["color"])):x("",!0),o.dataIndex==="acciones"?(m(),I(b,{key:4},[a(s,{type:"text",onClick:R=>q(r),style:{color:"#52c41a"},size:"small"},{icon:t(()=>[a(g(ie))]),_:2},1032,["onClick"]),a(s,{type:"text",onClick:R=>j(r),style:{color:"#ff4d4f"},size:"small"},{icon:t(()=>[a(g(re))]),_:2},1032,["onClick"])],64)):x("",!0)]),_:1},8,["data-source","loading"]),d("div",_e,[a(F,{current:N.value,"onUpdate:current":e[1]||(e[1]=o=>N.value=o),"page-size":50,total:A.value,onChange:v},null,8,["current","total"])])]),a(P,{visible:u.value,"onUpdate:visible":e[8]||(e[8]=o=>u.value=o),title:n.id?"Editar Credencial":"Nueva Credencial"},{footer:t(()=>[a(s,{onClick:e[7]||(e[7]=o=>u.value=!1)},{default:t(()=>e[14]||(e[14]=[i("Cancelar")])),_:1}),a(s,{type:"primary",onClick:$},{default:t(()=>[i(_(n.id?"Actualizar":"Guardar"),1)]),_:1})]),default:t(()=>[a(G,{model:n,layout:"vertical"},{default:t(()=>[a(f,{label:"DNI",required:""},{default:t(()=>[a(p,{value:n.dni,"onUpdate:value":e[2]||(e[2]=o=>n.dni=o),disabled:!!n.id,placeholder:"Ingrese DNI"},null,8,["value","disabled"])]),_:1}),a(f,{label:"Usuario",required:""},{default:t(()=>[a(p,{value:n.usuario,"onUpdate:value":e[3]||(e[3]=o=>n.usuario=o),placeholder:"Nombre completo"},null,8,["value"])]),_:1}),a(f,{label:"Departamento",required:""},{default:t(()=>[a(T,{value:n.departamento,"onUpdate:value":e[4]||(e[4]=o=>n.departamento=o),placeholder:"Seleccione departamento"},{default:t(()=>[a(E,{value:"ADMINISTRACIÓN"},{default:t(()=>e[11]||(e[11]=[i("ADMINISTRACIÓN")])),_:1}),a(E,{value:"ACADÉMICO"},{default:t(()=>e[12]||(e[12]=[i("ACADÉMICO")])),_:1}),a(E,{value:"TI"},{default:t(()=>e[13]||(e[13]=[i("TECNOLOGÍAS DE INFORMACIÓN")])),_:1})]),_:1},8,["value"])]),_:1}),a(f,{label:"Email",required:""},{default:t(()=>[a(p,{value:n.email,"onUpdate:value":e[5]||(e[5]=o=>n.email=o),placeholder:"correo@unap.edu.pe"},null,8,["value"])]),_:1}),a(f,{label:"Contraseña .p12",required:""},{default:t(()=>[a(V,{value:n.password_p12,"onUpdate:value":e[6]||(e[6]=o=>n.password_p12=o),placeholder:"Mínimo 6 caracteres"},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible","title"])]),_:1})],64)}}};export{Se as default};

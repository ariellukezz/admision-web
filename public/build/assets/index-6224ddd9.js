import{a as e,a3 as oe,a2 as v,r as u,e as $,o as m,c as g,u as b,w as n,F as le,y as S,n as R,Z as ie,d as x,b as y,t as I,f as D,E as B,a4 as M,B as se,I as re,_ as ce,h as ue,i as de,N as me,k as pe,l as _e,V as fe,a5 as ve,m as ge,q as be,M as xe}from"./app-a71e7b6d.js";import{_ as ye}from"./AuthenticatedLayout-81a5d659.js";import"./es-1b1d11a6.js";import{_ as he}from"./_plugin-vue_export-helper-c27b6911.js";import{L as we}from"./LinkOutlined-47a597a2.js";import{A as ke}from"./AntdIcon-6a6d4fab.js";import{U as De}from"./UploadOutlined-73da0a09.js";import{S as Fe}from"./SearchOutlined-08d62913.js";import{F as Oe}from"./FormOutlined-288359d0.js";import{D as Ye}from"./DeleteOutlined-bd841e39.js";import"./logotiny-c4b525af.js";import"./Header-6addb3f5.js";import"./DownOutlined-fe794b83.js";/* empty css                                                            */function V(d){for(var s=1;s<arguments.length;s++){var r=arguments[s]!=null?Object(arguments[s]):{},p=Object.keys(r);typeof Object.getOwnPropertySymbols=="function"&&(p=p.concat(Object.getOwnPropertySymbols(r).filter(function(f){return Object.getOwnPropertyDescriptor(r,f).enumerable}))),p.forEach(function(f){Ie(d,f,r[f])})}return d}function Ie(d,s,r){return s in d?Object.defineProperty(d,s,{value:r,enumerable:!0,configurable:!0,writable:!0}):d[s]=r,d}var N=function(s,r){var p=V({},s,r.attrs);return e(ke,V({},p,{icon:oe}),null)};N.displayName="FileOutlined";N.inheritAttrs=!1;const Me=N;const Ce={class:"bg-white overflow-hidden shadow-sm sm:rounded-lg p-4",style:{height:"calc(100vh - 103px)"}},Ee={class:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-4"},Se={class:"w-full md:w-auto relative flex-1 max-w-[300px]"},Re={class:"mb-4"},Ne={key:0,class:"text-sm"},Pe={key:2,class:"flex justify-center"},Ue={key:1,class:"text-gray-300"},je={key:3,class:"flex justify-center"},$e={key:4,class:"flex gap-2"},Be={class:"flex justify-end"},Ve={class:"flex justify-end mb-4"},ze={key:0,class:"mt-4"},Ae=["src"],Le={__name:"index",setup(d){v.locale("es");const s=u(""),r=u(1),p=u(50),f=u(0),h=u(!1),P=u([]);u([]);const w=u(""),o=u({id:null,nombre:"",estado:!0,inicio_vigencia:null,fin_vigencia:null,file:null}),C=u(),z=[{title:"Nombre",dataIndex:"nombre",width:"40%"},{title:"Versión",dataIndex:"version",align:"center",width:"100px"},{title:"Vigencia",dataIndex:"vigencia",align:"center",width:"150px"},{title:"Estado",dataIndex:"estado",align:"center",width:"100px"},{title:"Acciones",dataIndex:"acciones",align:"center",width:"150px"}],A={nombre:[{required:!0,message:"El nombre es obligatorio"}]};function L(a,t){let l;return function(..._){clearTimeout(l),l=setTimeout(()=>a.apply(this,_),t)}}const F=async()=>{try{const a=await S.post("get-reglamentos",{params:{search:s.value,page:r.value,per_page:p.value}});P.value=a.data.datos.data,f.value=a.data.datos.total}catch(a){console.error("Error fetching regulations:",a),R.error({message:"Error",description:"No se pudo cargar la lista de reglamentos"})}},T=()=>{h.value=!0},q=a=>{const t=a.type==="application/pdf"||a.name.toLowerCase().endsWith(".pdf"),l=a.size/1024/1024<2;if(!t)return M.error("Solo se permiten archivos PDF!"),!1;if(!l)return M.error("El archivo debe ser menor a 2MB!"),!1;const _=new FileReader;return _.onload=k=>{w.value=k.target.result,o.value.file=a},_.readAsDataURL(a),!1},G=()=>{w.value="",o.value.file=null},W=a=>{o.value={...a,estado:a.estado===1,id:a.id,inicio_vigencia:a.inicio_vigencia?v(a.inicio_vigencia):null,fin_vigencia:a.fin_vigencia?v(a.fin_vigencia):null},w.value=a.url,h.value=!0},Z=async()=>{var a,t;try{await C.value.validate();const l=new FormData;l.append("nombre",o.value.nombre),l.append("estado",o.value.estado?1:0),o.value.id&&l.append("id",o.value.id),o.value.inicio_vigencia&&l.append("inicio_vigencia",v(o.value.inicio_vigencia).format("YYYY-MM-DD")),o.value.fin_vigencia&&l.append("fin_vigencia",v(o.value.fin_vigencia).format("YYYY-MM-DD")),o.value.file&&l.append("file",o.value.file),await S({method:"post",url:"save-reglamento",data:l,headers:{"Content-Type":"multipart/form-data"}}),M.success("Reglamento guardado exitosamente!"),h.value=!1,F(),E()}catch(l){console.error("Error saving regulation:",l),R.error({message:"Error",description:((t=(a=l.response)==null?void 0:a.data)==null?void 0:t.message)||"Ocurrió un error al guardar"})}},H=async a=>{try{await S.get(`eliminar-reglamento/${a.id}`),M.success("Reglamento eliminado exitosamente!"),F()}catch(t){console.error("Error deleting regulation:",t),R.error({message:"Error",description:"No se pudo eliminar el reglamento"})}},E=()=>{var a;(a=C.value)==null||a.resetFields(),o.value={id:null,nombre:"",estado:!0,inicio_vigencia:null,fin_vigencia:null,file:null},w.value="",h.value=!1},J=(a,t)=>!a||!t?"":`${v(a).format("DD/MM/YY")} - ${v(t).format("DD/MM/YY")}`;return $(s,L(F,300)),$(r,F),F(),(a,t)=>{const l=se,_=re,k=ce,Q=ue,X=de,K=me,O=pe,Y=_e,U=fe,ee=ve,ae=ge,te=be,ne=xe;return m(),g(le,null,[e(b(ie),{title:"Procesos"}),e(ye,null,{default:n(()=>[x("div",Ce,[x("div",Ee,[e(l,{type:"primary",class:"w-full md:w-auto rounded-md bg-[#476175] hover:bg-[#3a5165] transition-colors",onClick:T},{default:n(()=>t[7]||(t[7]=[y(" Nuevo ")])),_:1}),x("div",Se,[e(_,{value:s.value,"onUpdate:value":t[0]||(t[0]=i=>s.value=i),placeholder:"Buscar",class:"w-full pl-3"},{prefix:n(()=>[e(b(Fe),{class:"text-gray-400"})]),_:1},8,["value"])])]),x("div",Re,[e(Q,{columns:z,"data-source":P.value,pagination:!1,size:"small",scroll:{x:380,y:"calc(100vh - 240px)"},class:"custom-table"},{bodyCell:n(({column:i,record:c})=>[i.dataIndex==="nombre"?(m(),g("span",Ne,I(c.nombre),1)):D("",!0),i.dataIndex==="version"?(m(),B(k,{key:1,color:"pink"},{default:n(()=>[y("V. "+I(c.version)+".0",1)]),_:2},1024)):D("",!0),i.dataIndex==="vigencia"?(m(),g("div",Pe,[c.vigencia?(m(),B(k,{key:0,color:"blue"},{default:n(()=>[y(I(J(c.inicio_vigencia,c.fin_vigencia)),1)]),_:2},1024)):(m(),g("span",Ue,"sin vigencia"))])):D("",!0),i.dataIndex==="estado"?(m(),g("div",je,[e(k,{color:c.estado?"blue":"red"},{default:n(()=>[y(I(c.estado?"activo":"inactivo"),1)]),_:2},1032,["color"])])):D("",!0),i.dataIndex==="acciones"?(m(),g("div",$e,[e(l,{onClick:j=>a.viewDetails(c),size:"small",class:"action-btn view-btn"},{default:n(()=>[e(b(we))]),_:2},1032,["onClick"]),e(l,{onClick:j=>W(c),size:"small",class:"action-btn edit-btn"},{default:n(()=>[e(b(Oe))]),_:2},1032,["onClick"]),e(l,{onClick:j=>H(c),size:"small",class:"action-btn delete-btn"},{default:n(()=>[e(b(Ye))]),_:2},1032,["onClick"])])):D("",!0)]),_:1},8,["data-source"])]),x("div",Be,[e(X,{current:r.value,"onUpdate:current":t[1]||(t[1]=i=>r.value=i),simple:"",pageSize:p.value,total:f.value},null,8,["current","pageSize","total"])])]),e(ne,{open:h.value,"onUpdate:open":t[6]||(t[6]=i=>h.value=i),title:o.value.id?"Editar Reglamento":"Nuevo Reglamento",width:"800px",onCancel:E},{footer:n(()=>[e(l,{onClick:E},{default:n(()=>t[9]||(t[9]=[y("Cancelar")])),_:1}),e(l,{type:"primary",onClick:Z},{default:n(()=>t[10]||(t[10]=[y("Guardar")])),_:1})]),default:n(()=>[e(te,{ref_key:"formRef",ref:C,model:o.value,rules:A,layout:"vertical"},{default:n(()=>[x("div",Ve,[e(O,{label:"Estado",name:"estado"},{default:n(()=>[e(K,{checked:o.value.estado,"onUpdate:checked":t[2]||(t[2]=i=>o.value.estado=i)},null,8,["checked"])]),_:1})]),e(ae,{gutter:[16,16]},{default:n(()=>[e(Y,{span:24},{default:n(()=>[e(O,{label:"Nombre",name:"nombre",rules:[{required:!0,message:"Este campo es obligatorio"}]},{default:n(()=>[e(_,{value:o.value.nombre,"onUpdate:value":t[3]||(t[3]=i=>o.value.nombre=i),placeholder:"Ingrese el nombre del reglamento"},{prefix:n(()=>[e(b(Me))]),_:1},8,["value"])]),_:1})]),_:1}),e(Y,{span:12},{default:n(()=>[e(O,{label:"Inicio vigencia",name:"inicio_vigencia"},{default:n(()=>[e(U,{value:o.value.inicio_vigencia,"onUpdate:value":t[4]||(t[4]=i=>o.value.inicio_vigencia=i),format:"DD/MM/YYYY",style:{width:"100%"},placeholder:"Seleccione fecha"},null,8,["value"])]),_:1})]),_:1}),e(Y,{span:12},{default:n(()=>[e(O,{label:"Fin vigencia",name:"fin_vigencia"},{default:n(()=>[e(U,{value:o.value.fin_vigencia,"onUpdate:value":t[5]||(t[5]=i=>o.value.fin_vigencia=i),format:"DD/MM/YYYY",style:{width:"100%"},placeholder:"Seleccione fecha"},null,8,["value"])]),_:1})]),_:1}),e(Y,{span:24},{default:n(()=>[e(O,{label:"Archivo PDF (Máx. 2MB)",name:"file"},{default:n(()=>[e(ee,{"file-list":o.value.file?[o.value.file]:[],"before-upload":q,onRemove:G,accept:".pdf","max-count":1},{default:n(()=>[e(l,null,{default:n(()=>[e(b(De)),t[8]||(t[8]=y(" Seleccionar archivo "))]),_:1})]),_:1},8,["file-list"]),w.value?(m(),g("div",ze,[x("embed",{src:w.value,type:"application/pdf",width:"100%",height:"300px"},null,8,Ae)])):D("",!0)]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["open","title"])]),_:1})],64)}}},oa=he(Le,[["__scopeId","data-v-c2509e01"]]);export{oa as default};
